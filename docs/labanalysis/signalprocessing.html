<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>labanalysis.signalprocessing API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../labanalysis.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;labanalysis</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#find_peaks">find_peaks</a>
            </li>
            <li>
                    <a class="function" href="#continuous_batches">continuous_batches</a>
            </li>
            <li>
                    <a class="function" href="#nextpow">nextpow</a>
            </li>
            <li>
                    <a class="function" href="#winter_derivative1">winter_derivative1</a>
            </li>
            <li>
                    <a class="function" href="#winter_derivative2">winter_derivative2</a>
            </li>
            <li>
                    <a class="function" href="#freedman_diaconis_bins">freedman_diaconis_bins</a>
            </li>
            <li>
                    <a class="function" href="#fir_filt">fir_filt</a>
            </li>
            <li>
                    <a class="function" href="#padwin">padwin</a>
            </li>
            <li>
                    <a class="function" href="#thresholding_filt">thresholding_filt</a>
            </li>
            <li>
                    <a class="function" href="#mean_filt">mean_filt</a>
            </li>
            <li>
                    <a class="function" href="#median_filt">median_filt</a>
            </li>
            <li>
                    <a class="function" href="#rms_filt">rms_filt</a>
            </li>
            <li>
                    <a class="function" href="#butterworth_filt">butterworth_filt</a>
            </li>
            <li>
                    <a class="function" href="#cubicspline_interp">cubicspline_interp</a>
            </li>
            <li>
                    <a class="function" href="#residual_analysis">residual_analysis</a>
            </li>
            <li>
                    <a class="function" href="#crossovers">crossovers</a>
            </li>
            <li>
                    <a class="function" href="#psd">psd</a>
            </li>
            <li>
                    <a class="function" href="#crossings">crossings</a>
            </li>
            <li>
                    <a class="function" href="#xcorr">xcorr</a>
            </li>
            <li>
                    <a class="function" href="#outlyingness">outlyingness</a>
            </li>
            <li>
                    <a class="function" href="#gram_schmidt">gram_schmidt</a>
            </li>
            <li>
                    <a class="function" href="#fillna">fillna</a>
            </li>
            <li>
                    <a class="function" href="#tkeo">tkeo</a>
            </li>
            <li>
                    <a class="function" href="#to_reference_frame">to_reference_frame</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../labanalysis.html">labanalysis</a><wbr>.signalprocessing    </h1>

                        <div class="docstring"><p>signalprocessing</p>

<p>A set of functions dedicated to the processing and analysis of 1D signals.</p>

<h6 id="functions">Functions</h6>

<p>find_peaks
    Find peaks in the signal.
continuous_batches
    Get the indices defining contiguous samples in the signal.
nextpow
    The next power of the selected base.
winter_derivative1
    Obtain the first derivative of a 1D signal according to Winter 2009 method.
winter_derivative2
    Obtain the second derivative of a 1D signal according to Winter 2009 method.
freedman_diaconis_bins
    Digitize a 1D signal in bins defined according to the Freedman-Diaconis rule.
fir_filt
    Apply a FIR (Finite Impulse Response) filter to a 1D signal.
mean_filt
    Apply a moving average filter to a 1D signal.
median_filt
    Apply a median filter to a 1D signal.
rms_filt
    Apply a RMS filter to a 1D signal.
butterworth_filt
    Apply a Butterworth filter to a 1D signal.
cubicspline_interp
    Apply cubic spline interpolation to a 1D signal.
residual_analysis
    Get the optimal cut-off frequency for a filter on 1D signals according to Winter 2009 'residual analysis' method.
crossovers
    Get the x-axis coordinates of the junction between the lines best fitting a 1D signal in a least-squares sense.
psd
    Obtain the power spectral density estimate of a 1D signal using the periodogram method.
crossings
    Obtain the location of the samples being across a target value.
xcorr
    Get the cross/auto-correlation and lag of multiple/one 1D signal.
outlyingness
    Return the adjusted outlyingness factor.
gram_schmidt
    Return the orthogonal basis defined by a set of points using the Gram-Schmidt algorithm.
fillna
    Fill missing data in numpy ndarray or pandas dataframe.
tkeo
    Obtain the discrete Teager-Kaiser Energy of the input signal.
padwin
    Pad the signal according to the given order and return the mask of indices defining each window on the signal.
to_reference_frame
    Rotate a 3D array or dataframe to the provided reference frame.</p>
</div>

                        <input id="mod-signalprocessing-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-signalprocessing-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">signalprocessing</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">A set of functions dedicated to the processing and analysis of 1D signals.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">Functions</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">---------</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">find_peaks</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">    Find peaks in the signal.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">continuous_batches</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">    Get the indices defining contiguous samples in the signal.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">nextpow</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">    The next power of the selected base.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">winter_derivative1</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">    Obtain the first derivative of a 1D signal according to Winter 2009 method.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">winter_derivative2</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    Obtain the second derivative of a 1D signal according to Winter 2009 method.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">freedman_diaconis_bins</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">    Digitize a 1D signal in bins defined according to the Freedman-Diaconis rule.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">fir_filt</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    Apply a FIR (Finite Impulse Response) filter to a 1D signal.</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">mean_filt</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">    Apply a moving average filter to a 1D signal.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">median_filt</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">    Apply a median filter to a 1D signal.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">rms_filt</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">    Apply a RMS filter to a 1D signal.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">butterworth_filt</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">    Apply a Butterworth filter to a 1D signal.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">cubicspline_interp</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    Apply cubic spline interpolation to a 1D signal.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">residual_analysis</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    Get the optimal cut-off frequency for a filter on 1D signals according to Winter 2009 &#39;residual analysis&#39; method.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">crossovers</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    Get the x-axis coordinates of the junction between the lines best fitting a 1D signal in a least-squares sense.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">psd</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">    Obtain the power spectral density estimate of a 1D signal using the periodogram method.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">crossings</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    Obtain the location of the samples being across a target value.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">xcorr</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    Get the cross/auto-correlation and lag of multiple/one 1D signal.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">outlyingness</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    Return the adjusted outlyingness factor.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">gram_schmidt</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    Return the orthogonal basis defined by a set of points using the Gram-Schmidt algorithm.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">fillna</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    Fill missing data in numpy ndarray or pandas dataframe.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">tkeo</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    Obtain the discrete Teager-Kaiser Energy of the input signal.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">padwin</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    Pad the signal according to the given order and return the mask of indices defining each window on the signal.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">to_reference_frame</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    Rotate a 3D array or dataframe to the provided reference frame.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="c1">#! IMPORTS</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>  <span class="c1"># type: ignore</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">CubicSpline</span>  <span class="c1"># type: ignore</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rotation</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.regression.ols.regression</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolynomialRegression</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>    <span class="s2">&quot;find_peaks&quot;</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>    <span class="s2">&quot;continuous_batches&quot;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="s2">&quot;nextpow&quot;</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="s2">&quot;winter_derivative1&quot;</span><span class="p">,</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="s2">&quot;winter_derivative2&quot;</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="s2">&quot;freedman_diaconis_bins&quot;</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="s2">&quot;fir_filt&quot;</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="s2">&quot;padwin&quot;</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="s2">&quot;thresholding_filt&quot;</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="s2">&quot;mean_filt&quot;</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="s2">&quot;median_filt&quot;</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="s2">&quot;rms_filt&quot;</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="s2">&quot;butterworth_filt&quot;</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="s2">&quot;cubicspline_interp&quot;</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="s2">&quot;residual_analysis&quot;</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="s2">&quot;crossovers&quot;</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="s2">&quot;psd&quot;</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="s2">&quot;crossings&quot;</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="s2">&quot;xcorr&quot;</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="s2">&quot;outlyingness&quot;</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="s2">&quot;gram_schmidt&quot;</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="s2">&quot;fillna&quot;</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="s2">&quot;tkeo&quot;</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="s2">&quot;to_reference_frame&quot;</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="p">]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="c1">#! FUNCTIONS</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_peaks</span><span class="p">(</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    Find peaks in the signal.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">    Parameters</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">    ----------</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        The input signal.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    height : int or float or None, optional</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        The minimum height of the peaks.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">    distance : int or None, optional</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        The minimum distance between the peaks.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">    Returns</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    -------</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        The array containing the indices of the detected peaks.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>    <span class="c1"># get all peaks</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="n">d1y</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">d1y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d1y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="c1"># select those peaks at minimum height</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">]</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="c1"># select those peaks separated at minimum by the given distance</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">):</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="k">if</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>                    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">[:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>                    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="k">return</span> <span class="n">all_peaks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="k">def</span><span class="w"> </span><span class="nf">continuous_batches</span><span class="p">(</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">    Return the list of indices defining batches where consecutive arr values are True.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    Parameters</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    ----------</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">        A 1D boolean array.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">    Returns</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">    -------</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">    list of list of int</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        A list of lists containing the indices defining each batch of consecutive True values.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>    <span class="n">locs</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">idxs</span><span class="p">])</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">locs</span> <span class="o">+</span> <span class="n">idxs</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="k">if</span> <span class="n">locs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">crs</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="n">stops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crs</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="n">batches</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">stops</span><span class="p">)]</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="c1"># join those gaps separated by less than the provided tolerance</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="k">if</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>            <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="n">batches</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="k">return</span> <span class="n">batches</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nextpow</span><span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="n">val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>    <span class="n">base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    Get the next power of the provided value according to the given base.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">    Parameters</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">    ----------</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    val : int or float</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        The target value.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    base : int, optional</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        The base to be elevated.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">    Returns</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    -------</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    int</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">        The next power of the provided value according to the given base.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">base</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="p">))))</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="k">def</span><span class="w"> </span><span class="nf">winter_derivative1</span><span class="p">(</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="n">x_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    Return the first derivative of y.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    Parameters</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">    ----------</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        The signal to be differentiated.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">    x_signal : np.ndarray or None, optional</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        The optional signal from which y has to be differentiated (default: None).</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">    time_diff : float or int, optional</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        The difference between samples in y. Ignored if x_signal is provided.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">    Returns</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    -------</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        The first derivative of y.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">    References</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    ----------</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="c1"># get x</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="k">if</span> <span class="n">x_signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">))</span> <span class="o">*</span> <span class="n">time_diff</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">x_signal</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="c1"># get the derivative</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">y_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y_signal</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_sig</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x_sig</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="k">def</span><span class="w"> </span><span class="nf">winter_derivative2</span><span class="p">(</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>    <span class="n">x_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">    Return the second derivative of y.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">    Parameters</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">    ----------</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">        The signal to be differentiated.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">    x_signal : np.ndarray or None, optional</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        The optional signal from which y has to be differentiated (default: None).</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">    time_diff : float or int, optional</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        The difference between samples in y. Ignored if x_signal is provided.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">    Returns</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    -------</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        The second derivative of y.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">    References</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">    ----------</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">    Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>    <span class="c1"># get x</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="k">if</span> <span class="n">x_signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">))</span> <span class="o">*</span> <span class="n">time_diff</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_signal</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="c1"># get the derivative</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="n">num</span> <span class="o">=</span> <span class="n">y_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">y_signal</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y_signal</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_sig</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="k">def</span><span class="w"> </span><span class="nf">freedman_diaconis_bins</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    Digitize a 1D signal in bins defined according to the Freedman-Diaconis rule.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">    Parameters</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">    ----------</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        The signal to be digitized.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">    Returns</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">    -------</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        An array with the same shape as y containing the index of the bin for each sample.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">    References</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">    ----------</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">    Freedman D, Diaconis P. (1981) On the histogram as a density estimator: L2 theory. Z. Wahrscheinlichkeitstheorie verw Gebiete 57: 453-476. doi: 10.1007/BF01025868</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="c1"># y IQR</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>    <span class="n">qnt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y_signal</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="n">qnt3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y_signal</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="n">iqr</span> <span class="o">=</span> <span class="n">qnt3</span> <span class="o">-</span> <span class="n">qnt1</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="c1"># get the width</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="n">wdt</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">iqr</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>    <span class="c1"># get the number of intervals</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="n">samp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">wdt</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>    <span class="c1"># digitize z</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>    <span class="n">digitized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">y_signal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">((</span><span class="n">y_signal</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">wdt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_signal</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">wdt</span><span class="p">))</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">digitized</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="k">return</span> <span class="n">digitized</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="k">def</span><span class="w"> </span><span class="nf">padwin</span><span class="p">(</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">    Pad the signal according to the given order and return the mask of indices defining each window on the signal.</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">    Parameters</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    ----------</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        The number of samples to be considered as averaging window.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        The type of padding style adopted before filtering.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">    offset : float, optional</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">    Returns</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">    -------</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">    pad : np.ndarray</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        The padded signal.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    mask : np.ndarray</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        A 2D mask where each row denotes the indices of one window on the signal.</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="c1"># get the window range</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>    <span class="c1"># padding</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    <span class="c1"># get the windows mask</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">([</span><span class="n">rng</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="k">return</span> <span class="n">pad</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="k">def</span><span class="w"> </span><span class="nf">thresholding_filt</span><span class="p">(</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="n">robust</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">    Apply a thresholding filter where only those values being moving average filter to the signal.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">    Parameters</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">    ----------</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">    factor : float or int, optional</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">        The factor multiplied by the standard deviation of the window to detect extremes.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">    robust : bool, optional</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">        If True, use median and MAD; otherwise, use mean and std.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">        The type of padding style.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">    offset : float, optional</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">    Returns</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">    -------</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="c1"># pad the array</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="n">pads</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">padwin</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">pad_style</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="c1"># get the required values</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="c1"># replace the extreme values</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="n">extremes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">thresh</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="n">out</span><span class="p">[</span><span class="n">extremes</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">extremes</span><span class="p">]</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>    <span class="k">return</span> <span class="n">out</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mean_filt</span><span class="p">(</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">    Apply a moving average filter to the signal.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    Parameters</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">    ----------</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        The type of padding style.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">    offset : float, optional</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">    Returns</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">    -------</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="c1"># get the window range</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">init</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="c1"># padding</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>    <span class="c1"># get the cumulative sum of the signal</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="n">csum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="c1"># get the mean</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">stop</span><span class="p">]</span> <span class="o">-</span> <span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">init</span><span class="p">])</span> <span class="o">/</span> <span class="n">order</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="k">def</span><span class="w"> </span><span class="nf">median_filt</span><span class="p">(</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">    Apply a median filter to the signal.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">    Parameters</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">    ----------</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        The type of padding style.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">    offset : float, optional</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">    Returns</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">    -------</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="n">pad</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">padwin</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">pad_style</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rms_filt</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">    Obtain the root-mean-square of the signal with the given sampling window.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">    Parameters</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">    ----------</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        The type of padding style.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">    offset : float, optional</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">    Returns</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">    -------</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="c1"># get the window range</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">stop</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="c1"># padding</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="c1"># get the squares of the signal</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="n">sqe</span> <span class="o">=</span> <span class="n">pad</span><span class="o">**</span><span class="mi">2</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="c1"># get the cumulative sum of the signal</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="n">csum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sqe</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>    <span class="c1"># get the root mean of the squares</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>    <span class="k">return</span> <span class="p">((</span><span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">stop</span><span class="p">]</span> <span class="o">-</span> <span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">init</span><span class="p">])</span> <span class="o">/</span> <span class="n">order</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fir_filt</span><span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;lowpass&quot;</span><span class="p">,</span> <span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandstop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lowpass&quot;</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="n">wtype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="s2">&quot;boxcar&quot;</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="s2">&quot;triang&quot;</span><span class="p">,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="s2">&quot;blackman&quot;</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="s2">&quot;bartlett&quot;</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="s2">&quot;flattop&quot;</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="s2">&quot;parzen&quot;</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="s2">&quot;bohman&quot;</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="s2">&quot;blackmanharris&quot;</span><span class="p">,</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="s2">&quot;nuttall&quot;</span><span class="p">,</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="s2">&quot;barthann&quot;</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="s2">&quot;exponential&quot;</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="s2">&quot;tukey&quot;</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="s2">&quot;taylor&quot;</span><span class="p">,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>    <span class="n">pstyle</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="s2">&quot;linear_ramp&quot;</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="s2">&quot;maximum&quot;</span><span class="p">,</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="s2">&quot;minimum&quot;</span><span class="p">,</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="s2">&quot;reflect&quot;</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="s2">&quot;symmetric&quot;</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="s2">&quot;wrap&quot;</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">    Apply a FIR filter with the specified specs to the signal.</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">    Parameters</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">    ----------</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">    fcut : float, int, list, or tuple, optional</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">        The cutoff frequency of the filter.</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        The sampling frequency of the signal.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        The order of the filter.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">    ftype : str, optional</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">        The type of filter: &quot;bandpass&quot;, &quot;lowpass&quot;, &quot;highpass&quot;, &quot;bandstop&quot;.</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">    wtype : str, optional</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        The type of window to be applied.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">    pstyle : str, optional</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        The type of padding style.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">    Returns</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">    -------</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>    <span class="n">coefs</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="n">order</span><span class="p">,</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">fcut</span><span class="p">,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="n">window</span><span class="o">=</span><span class="n">wtype</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="n">pass_zero</span><span class="o">=</span><span class="n">ftype</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">fs</span><span class="o">=</span><span class="n">fsamp</span><span class="p">,</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>    <span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>    <span class="n">val</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pstyle</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="n">arr</span><span class="p">,</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">pstyle</span><span class="p">,</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="n">constant_values</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>    <span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>    <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">padded</span> <span class="o">-</span> <span class="n">avg</span><span class="p">)[(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">avg</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="k">def</span><span class="w"> </span><span class="nf">butterworth_filt</span><span class="p">(</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>    <span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    <span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;lowpass&quot;</span><span class="p">,</span> <span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandstop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lowpass&quot;</span><span class="p">,</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>    <span class="n">phase_corrected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">    Apply a Butterworth filter with the specified parameters.</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">    Parameters</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">    ----------</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">    fcut : float, int, list, or tuple, optional</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        The cutoff frequency of the filter.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        The sampling frequency of the signal.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">    order : int, optional</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        The order of the filter.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">    ftype : str, optional</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        The type of filter: &quot;bandpass&quot;, &quot;lowpass&quot;, &quot;highpass&quot;, &quot;bandstop&quot;.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">    phase_corrected : bool, optional</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        If True, apply the filter twice in opposite directions to correct for phase lag.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">    Returns</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">    -------</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        The filtered signal.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>    <span class="c1"># get the filter coefficients</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">order</span><span class="p">,</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fcut</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">fsamp</span><span class="p">)),</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">ftype</span><span class="p">,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">output</span><span class="o">=</span><span class="s2">&quot;sos&quot;</span><span class="p">,</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="c1"># get the filtered data</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="k">if</span> <span class="n">phase_corrected</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arr</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cubicspline_interp</span><span class="p">(</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>    <span class="n">y_old</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="n">nsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>    <span class="n">x_old</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="n">x_new</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">    Get the cubic spline interpolation of y.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    Parameters</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">    ----------</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    y_old : np.ndarray</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        The data to be interpolated.</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">    nsamp : int or None, optional</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">        The number of points for the interpolation.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">    x_old : np.ndarray or None, optional</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        The x coordinates corresponding to y. Ignored if nsamp is provided.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">    x_new : np.ndarray or None, optional</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        The new x coordinates for interpolation. Ignored if nsamp is provided.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">    Returns</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">    -------</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">        The interpolated y axis.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>    <span class="c1"># control of the inputs</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="k">if</span> <span class="n">nsamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="k">if</span> <span class="n">x_old</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the pair x_old / x_new or nsamp must be defined&quot;</span><span class="p">)</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_old</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_old</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_old</span><span class="p">),</span> <span class="n">nsamp</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="c1"># get the cubic-spline interpolated y</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="n">cspline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x_old</span><span class="p">,</span> <span class="n">y_old</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>    <span class="k">return</span> <span class="n">cspline</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="k">def</span><span class="w"> </span><span class="nf">residual_analysis</span><span class="p">(</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="n">ffun</span><span class="p">:</span> <span class="n">FunctionType</span> <span class="o">|</span> <span class="n">MethodType</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>    <span class="n">fnum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>    <span class="n">nseg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="n">minsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">    Perform Winter&#39;s residual analysis of the input signal.</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">    Parameters</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">    ----------</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">        The signal to be investigated.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">    ffun : FunctionType or MethodType</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        The filter to be used for the analysis.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">    fnum : int, optional</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        The number of frequencies to be tested.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">    fmax : float or int or None, optional</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        The maximum frequency to be tested.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">    nseg : int, optional</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        The number of segments for fitting.</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">    minsamp : int, optional</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        The minimum number of elements per segment.</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">    Returns</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">    -------</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">    float</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        The suggested cutoff value.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        The tested frequencies.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        The residuals corresponding to the given frequency.</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">    Notes</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">    -----</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">    The signal is filtered over a range of frequencies and the sum of squared residuals (SSE) against the original signal is computed for each tested cut-off frequency. Next, a series of fitting lines are used to estimate the optimal disruption point defining the cut-off frequency optimally discriminating between noise and good quality signal.</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">    References</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">    ----------</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">    Winter DA 2009, Biomechanics and Motor Control of Human Movement. Fourth Ed. John Wiley &amp; Sons Inc, Hoboken, New Jersey (US).</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">    Lerman PM 1980, Fitting Segmented Regression Models by Grid Search.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        Appl Stat. 29(1):77.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>    <span class="c1"># data check</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>    <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">pwr</span><span class="p">,</span> <span class="n">frq</span> <span class="o">=</span> <span class="n">psd</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pwr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pwr</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.99</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">frq</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">fmax</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;fmax must lie in the (0, 0.5) range.&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>    <span class="k">assert</span> <span class="n">minsamp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;&#39;min_samples&#39; must be &gt;= 2.&quot;</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>    <span class="c1"># get the optimal crossing over point</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="n">frq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">fnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">arr</span> <span class="o">-</span> <span class="n">ffun</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">frq</span><span class="p">])</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="n">iopt</span> <span class="o">=</span> <span class="n">crossovers</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">nseg</span><span class="p">,</span> <span class="n">minsamp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>    <span class="n">fopt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">iopt</span><span class="p">])</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="c1"># return the parameters</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>    <span class="k">return</span> <span class="n">fopt</span><span class="p">,</span> <span class="n">frq</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_sse</span><span class="p">(</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="n">xval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>    <span class="n">yval</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="n">segm</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="p">):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">    method used to calculate the residuals</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">    Parameters</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">    ----------</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a><span class="sd">    xval: np.ndarray[Any, np.dtype[np.float64]],</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">        the x axis signal</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">    yval: np.ndarray[Any, np.dtype[np.float64]],</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">        the y axis signal</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">    segm: list[tuple[int]],</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">        the extremes among which the segments have to be fitted</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">    Returns</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">    -------</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">    sse: float</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        the sum of squared errors corresponding to the error obtained</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        fitting the y-x relationship according to the segments provided</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        by s.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>    <span class="n">sse</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segm</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">segm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">segm</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">xval</span><span class="p">[</span><span class="n">coords</span><span class="p">],</span> <span class="n">yval</span><span class="p">[</span><span class="n">coords</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">xval</span><span class="p">[</span><span class="n">coords</span><span class="p">])</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="n">sse</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yval</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">sse</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="k">def</span><span class="w"> </span><span class="nf">crossovers</span><span class="p">(</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="n">segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">    Detect the position of the crossing over points between K regression lines used to best fit the data.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">    Parameters</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">    ----------</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        The signal to be fitted.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">    segments : int, optional</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        The number of segments for fitting.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">    min_samples : int, optional</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        The minimum number of elements per segment.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">    Returns</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">    -------</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">        Indices of the detected crossing over points.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        Slopes and intercepts of the fitting segments.</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">    Notes</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">    -----</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">    Steps:</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">        1) Get all segment combinations.</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        2) For each, calculate regression lines.</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">        3) For each, calculate residuals.</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        4) Sort by residuals.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">        5) Return best combination.</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">    References</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">    ----------</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">    Lerman PM 1980, Fitting Segmented Regression Models by Grid Search. Appl Stat. 29(1):77.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="c1"># control the inputs</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="k">assert</span> <span class="n">min_samples</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;&#39;min_samples&#39; must be &gt;= 2.&quot;</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="c1"># get the X axis</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="c1"># get all the possible combinations of segments</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">):</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">min_samples</span> <span class="o">*</span> <span class="n">i</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_samples</span> <span class="o">*</span> <span class="p">(</span><span class="n">segments</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="n">combs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)]</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">combs</span><span class="p">))</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="c1"># remove those combinations having segments shorter than &quot;samples&quot;</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combs</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="c1"># generate the crossovers matrix</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">combs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="c1"># calculate the residuals for each combination</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_sse</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">])</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="c1"># sort the residuals</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>    <span class="n">sortedsse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sse</span><span class="p">)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="c1"># get the optimal crossovers order</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">sortedsse</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="c1"># get the fitting slopes</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">crs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">crs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">slopes</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="p">]</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>    <span class="c1"># return the crossovers</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="k">return</span> <span class="n">crs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">slopes</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="k">def</span><span class="w"> </span><span class="nf">psd</span><span class="p">(</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">    Compute the power spectrum of signal using FFT.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">    Parameters</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">    ----------</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        A 1D numpy array.</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        The sampling frequency (Hz) of the signal.</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">    Returns</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">    -------</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        The frequency corresponding to each element of power.</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        The power of each frequency.</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="c1"># get the psd</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="n">amp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>    <span class="n">pwr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">amp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">amp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">amp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="n">frq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fsamp</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwr</span><span class="p">))</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="c1"># return the data</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>    <span class="k">return</span> <span class="n">frq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">pwr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="k">def</span><span class="w"> </span><span class="nf">crossings</span><span class="p">(</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    Detect the crossing points in arr compared to value.</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">    Parameters</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">    ----------</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">        The 1D signal from which the crossings have to be found.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">    value : int or float, optional</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">        The crossing value.</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    Returns</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">    -------</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">        The samples corresponding to the crossings.</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">        The sign of the crossings.</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="c1"># get the sign of the signal without the offset</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>    <span class="n">sgn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="c1"># get the location of the crossings</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgn</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sgn</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="c1"># return the crossings</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="k">return</span> <span class="n">crs</span><span class="p">,</span> <span class="o">-</span><span class="n">sgn</span><span class="p">[</span><span class="n">crs</span><span class="p">]</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="k">def</span><span class="w"> </span><span class="nf">xcorr</span><span class="p">(</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>    <span class="n">sig1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>    <span class="n">sig2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="n">biased</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    Set the (multiple) auto/cross correlation of the data in y.</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">    Parameters</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    ----------</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    sig1 : np.ndarray</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        The signal for auto/cross-correlation.</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    sig2 : np.ndarray or None, optional</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">        The second signal for cross-correlation. If None, autocorrelation is computed.</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">    biased : bool, optional</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">        If True, use the biased estimator.</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    full : bool, optional</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">        If True, report negative lags.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">    Returns</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">    -------</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        The auto/cross-correlation value.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">        The lags in sample units.</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="c1"># take the autocorrelation if only y is provided</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="k">if</span> <span class="n">sig2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="n">sigx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sig1</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="n">sigz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sigx</span><span class="p">,</span> <span class="n">sigx</span><span class="p">])</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="c1"># take the cross-correlation (ensure the shortest signal is zero-padded)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="n">sigx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sig1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig2</span><span class="p">))))</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="n">sigy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sigx</span><span class="p">)</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="n">sigx</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sig1</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="n">sigy</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sig2</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">sigz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sigx</span><span class="p">,</span> <span class="n">sigy</span><span class="p">])</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>    <span class="c1"># get the matrix shape</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">sigz</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="c1"># remove the mean from each dimension</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>    <span class="n">sigv</span> <span class="o">=</span> <span class="n">sigz</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sigz</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>    <span class="c1"># take the cross-correlation</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>    <span class="n">xcr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">sigv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigv</span><span class="p">[</span><span class="n">j</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;full&quot;</span><span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="n">xcr</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">res</span><span class="p">)]</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>    <span class="c1"># average over all the multiples</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="n">xcr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">xcr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="c1"># adjust the output</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cols</span><span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="n">xcr</span> <span class="o">=</span> <span class="n">xcr</span><span class="p">[(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span><span class="p">[(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="c1"># normalize</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="n">xcr</span> <span class="o">/=</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lags</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">biased</span> <span class="k">else</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>    <span class="c1"># return the cross-correlation data</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>    <span class="k">return</span> <span class="n">xcr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">lags</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="k">def</span><span class="w"> </span><span class="nf">outlyingness</span><span class="p">(</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">    Return the adjusted outlyingness factor.</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">    Parameters</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">    ----------</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        The input array.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">    Returns</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">    -------</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        The outlyingness score of each element.</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">    References</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">    ----------</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">    Hubert, M., &amp; Van der Veeken, S. (2008). Outlier detection for skewed data. Journal of Chemometrics: A Journal of the Chemometrics Society, 22(34), 235-246.</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>    <span class="n">qr1</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">qr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>    <span class="n">iqr</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">-</span> <span class="n">qr1</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="n">med</span><span class="p">]</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="n">upp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="n">med</span><span class="p">]</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="n">mcs</span> <span class="o">=</span> <span class="p">[((</span><span class="n">j</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">upp</span><span class="p">)]</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="n">mcs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="k">if</span> <span class="n">mcs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">wt1</span> <span class="o">=</span> <span class="n">qr1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">wt2</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="n">wt1</span> <span class="o">=</span> <span class="n">qr1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="n">wt2</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">med</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">med</span><span class="p">:</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">wt2</span> <span class="o">-</span> <span class="n">med</span><span class="p">)]</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">med</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">wt1</span><span class="p">)]</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gram_schmidt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">    applies Gram-Schmidt process to obtain ortonormal bases starting from</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">    3 vectors (i, j, k)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">    Parameters</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">    ----------</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">    - i, j, k: array (N, 3)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">    Returns</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">    -------</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">    - R: array (N, 3, 3)</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="c1"># Primo vettore normalizzato</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>    <span class="n">e1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>    <span class="c1"># Proiezione di j su e1 e ortogonalizzazione</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>    <span class="n">proj_j_on_e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">e1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>    <span class="n">u2</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="n">proj_j_on_e1</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>    <span class="n">e2</span> <span class="o">=</span> <span class="n">u2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="c1"># Proiezione di k su e1 ed e2 e ortogonalizzazione</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="n">proj_k_on_e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">e1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="n">proj_k_on_e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e2</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="n">u3</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">proj_k_on_e1</span> <span class="o">-</span> <span class="n">proj_k_on_e2</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">e3</span> <span class="o">=</span> <span class="n">u3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>        <span class="c1"># calcolo come prodotto vettoriale</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="c1"># Stack dei vettori ortonormali come colonne della matrice di rotazione</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># shape (N, 3, 3)</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fillna</span><span class="p">(</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>    <span class="n">n_regressors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="p">):</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">    Fill missing values in the array or dataframe.</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">    Parameters</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">    ----------</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">    arr : np.ndarray | DataFrame | Series,</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        array with nans to be filled</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">    value : float or None</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        the value to be used for missing data replacement.</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        if None, nearest neighbours imputation from the sklearn package is</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        used.</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">    n_regressors : int | None, default=None</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        Number of regressors to be used in a Multiple Linear Regression model.</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">        The model used the &quot;n_regressors&quot; most correlated columns of</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">        arr as independent variables to fit the missing values. The procedure</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        is repeated for each dimension separately.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        If None, cubic spline interpolation is used on each column separately.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">    inplace : bool, optional</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        If True, fill in place (for DataFrame/Series). If False, return a new object.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">    Returns</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">    -------</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">    filled: np.ndarray, DataFrame, or Series</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        the vector without missing data.</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>    <span class="c1"># check if missing values exist</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Series</span><span class="p">)):</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="s2">&quot;&#39;arr&#39; must be a numpy.ndarray a pandas.DataFrame or a pandas.Series.&quot;</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="p">)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">arr</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="n">miss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="c1"># otherwise return a copy of the actual vector</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">miss</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>    <span class="c1"># fill with the given value</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">miss</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>                <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>            <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                <span class="n">arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>    <span class="c1"># check if linear regression models have to be used</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>    <span class="k">if</span> <span class="n">n_regressors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="c1"># get the correlation matrix</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>        <span class="n">cmat</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="c1"># predict the missing values via linear regression over each column</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ycol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>            <span class="c1"># get the best regressors</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>            <span class="n">corrs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cmat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>            <span class="n">cor_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">corrs</span><span class="p">)[</span><span class="o">-</span><span class="n">n_regressors</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>            <span class="n">xcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cor_idx</span><span class="p">]</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="c1"># get the indices of the samples that can be used for training</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="c1"># the regression model and those samples that can be predicted</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            <span class="c1"># with that model</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>            <span class="n">i_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obj</span><span class="p">[[</span><span class="n">ycol</span><span class="p">]</span> <span class="o">+</span> <span class="n">xcols</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="n">i_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="n">ycol</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">obj</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="c1"># if there are enough valid samples get the predictions and replace</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="c1"># the missing data</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_new</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                <span class="n">xmat</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_old</span><span class="p">,</span> <span class="n">xcols</span><span class="p">]</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                <span class="n">yarr</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_old</span><span class="p">,</span> <span class="p">[</span><span class="n">ycol</span><span class="p">]]</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>                <span class="n">lrm</span> <span class="o">=</span> <span class="n">PolynomialRegression</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xmat</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_new</span><span class="p">,</span> <span class="n">xcols</span><span class="p">])</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_new</span><span class="p">,</span> <span class="n">ycol</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>    <span class="c1"># fill the missing data of each set via cubic spline</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_old</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="n">y_old</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">x_old</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">x_new</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x_old</span><span class="p">,</span> <span class="n">y_old</span><span class="p">)(</span><span class="n">x_new</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>    <span class="c1"># return the filled array</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>            <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="n">arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="k">def</span><span class="w"> </span><span class="nf">tkeo</span><span class="p">(</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">    Obtain the discrete Teager-Keiser Energy of the input signal.</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">    Parameters</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">    ----------</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">        A 1D input signal.</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">    Returns</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">    -------</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">    np.ndarray</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        The Teager-Keiser energy.</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="k">def</span><span class="w"> </span><span class="nf">to_reference_frame</span><span class="p">(</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>    <span class="n">obj</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>    <span class="n">origin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>    <span class="n">axis1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>    <span class="n">axis2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>    <span class="n">axis3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">    Rotate a 3D array or dataframe to the provided reference frame.</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">    Parameters</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">    ----------</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">    obj : DataFrame or np.ndarray</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">        The 3D array or dataframe to be rotated.</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">    origin : np.ndarray or list, optional</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">        Coordinates of the target origin.</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">    axis1 : np.ndarray or list, optional</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">        Orientation of the first axis of the new reference frame.</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">    axis2 : np.ndarray or list, optional</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">        Orientation of the second axis of the new reference frame.</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">    axis3 : np.ndarray or list, optional</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        Orientation of the third axis of the new reference frame.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">    Returns</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">    -------</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">    DataFrame or np.ndarray</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">        The rotated data.</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_array</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;origin, axis1, axis2 and axis3 have to be&quot;</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; castable to 1D arrays of len = 3.&quot;</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arr</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="c1"># check inputs</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;obj&#39; must be a numeric pandas DataFrame or a 2D numpy array&quot;</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; with 3 elements along the second dimension.&quot;</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="n">dfr</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>    <span class="n">ori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="n">ax1</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis1</span><span class="p">)</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>    <span class="n">ax2</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis2</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>    <span class="n">ax3</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis3</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>    <span class="c1"># create the rotation matrix</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>    <span class="n">rmat</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">gram_schmidt</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>    <span class="c1"># apply</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>    <span class="n">rotated</span> <span class="o">=</span> <span class="n">rmat</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">ori</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="k">return</span> <span class="n">rotated</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">rotated</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="find_peaks">
                            <input id="find_peaks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_peaks</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="find_peaks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#find_peaks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="find_peaks-102"><a href="#find_peaks-102"><span class="linenos">102</span></a><span class="k">def</span><span class="w"> </span><span class="nf">find_peaks</span><span class="p">(</span>
</span><span id="find_peaks-103"><a href="#find_peaks-103"><span class="linenos">103</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="find_peaks-104"><a href="#find_peaks-104"><span class="linenos">104</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="find_peaks-105"><a href="#find_peaks-105"><span class="linenos">105</span></a>    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="find_peaks-106"><a href="#find_peaks-106"><span class="linenos">106</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="find_peaks-107"><a href="#find_peaks-107"><span class="linenos">107</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="find_peaks-108"><a href="#find_peaks-108"><span class="linenos">108</span></a><span class="sd">    Find peaks in the signal.</span>
</span><span id="find_peaks-109"><a href="#find_peaks-109"><span class="linenos">109</span></a>
</span><span id="find_peaks-110"><a href="#find_peaks-110"><span class="linenos">110</span></a><span class="sd">    Parameters</span>
</span><span id="find_peaks-111"><a href="#find_peaks-111"><span class="linenos">111</span></a><span class="sd">    ----------</span>
</span><span id="find_peaks-112"><a href="#find_peaks-112"><span class="linenos">112</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="find_peaks-113"><a href="#find_peaks-113"><span class="linenos">113</span></a><span class="sd">        The input signal.</span>
</span><span id="find_peaks-114"><a href="#find_peaks-114"><span class="linenos">114</span></a><span class="sd">    height : int or float or None, optional</span>
</span><span id="find_peaks-115"><a href="#find_peaks-115"><span class="linenos">115</span></a><span class="sd">        The minimum height of the peaks.</span>
</span><span id="find_peaks-116"><a href="#find_peaks-116"><span class="linenos">116</span></a><span class="sd">    distance : int or None, optional</span>
</span><span id="find_peaks-117"><a href="#find_peaks-117"><span class="linenos">117</span></a><span class="sd">        The minimum distance between the peaks.</span>
</span><span id="find_peaks-118"><a href="#find_peaks-118"><span class="linenos">118</span></a>
</span><span id="find_peaks-119"><a href="#find_peaks-119"><span class="linenos">119</span></a><span class="sd">    Returns</span>
</span><span id="find_peaks-120"><a href="#find_peaks-120"><span class="linenos">120</span></a><span class="sd">    -------</span>
</span><span id="find_peaks-121"><a href="#find_peaks-121"><span class="linenos">121</span></a><span class="sd">    np.ndarray</span>
</span><span id="find_peaks-122"><a href="#find_peaks-122"><span class="linenos">122</span></a><span class="sd">        The array containing the indices of the detected peaks.</span>
</span><span id="find_peaks-123"><a href="#find_peaks-123"><span class="linenos">123</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="find_peaks-124"><a href="#find_peaks-124"><span class="linenos">124</span></a>    <span class="c1"># get all peaks</span>
</span><span id="find_peaks-125"><a href="#find_peaks-125"><span class="linenos">125</span></a>    <span class="n">d1y</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="find_peaks-126"><a href="#find_peaks-126"><span class="linenos">126</span></a>    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">d1y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d1y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="find_peaks-127"><a href="#find_peaks-127"><span class="linenos">127</span></a>
</span><span id="find_peaks-128"><a href="#find_peaks-128"><span class="linenos">128</span></a>    <span class="c1"># select those peaks at minimum height</span>
</span><span id="find_peaks-129"><a href="#find_peaks-129"><span class="linenos">129</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="find_peaks-130"><a href="#find_peaks-130"><span class="linenos">130</span></a>        <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">]</span>
</span><span id="find_peaks-131"><a href="#find_peaks-131"><span class="linenos">131</span></a>
</span><span id="find_peaks-132"><a href="#find_peaks-132"><span class="linenos">132</span></a>    <span class="c1"># select those peaks separated at minimum by the given distance</span>
</span><span id="find_peaks-133"><a href="#find_peaks-133"><span class="linenos">133</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="find_peaks-134"><a href="#find_peaks-134"><span class="linenos">134</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="find_peaks-135"><a href="#find_peaks-135"><span class="linenos">135</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">):</span>
</span><span id="find_peaks-136"><a href="#find_peaks-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
</span><span id="find_peaks-137"><a href="#find_peaks-137"><span class="linenos">137</span></a>                <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]:</span>
</span><span id="find_peaks-138"><a href="#find_peaks-138"><span class="linenos">138</span></a>                    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">[:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="find_peaks-139"><a href="#find_peaks-139"><span class="linenos">139</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="find_peaks-140"><a href="#find_peaks-140"><span class="linenos">140</span></a>                    <span class="n">all_peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_peaks</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>
</span><span id="find_peaks-141"><a href="#find_peaks-141"><span class="linenos">141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="find_peaks-142"><a href="#find_peaks-142"><span class="linenos">142</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="find_peaks-143"><a href="#find_peaks-143"><span class="linenos">143</span></a>
</span><span id="find_peaks-144"><a href="#find_peaks-144"><span class="linenos">144</span></a>    <span class="k">return</span> <span class="n">all_peaks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find peaks in the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The input signal.</li>
<li><strong>height</strong> (int or float or None, optional):
The minimum height of the peaks.</li>
<li><strong>distance</strong> (int or None, optional):
The minimum distance between the peaks.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The array containing the indices of the detected peaks.</li>
</ul>
</div>


                </section>
                <section id="continuous_batches">
                            <input id="continuous_batches-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">continuous_batches</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>, </span><span class="param"><span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="continuous_batches-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#continuous_batches"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="continuous_batches-147"><a href="#continuous_batches-147"><span class="linenos">147</span></a><span class="k">def</span><span class="w"> </span><span class="nf">continuous_batches</span><span class="p">(</span>
</span><span id="continuous_batches-148"><a href="#continuous_batches-148"><span class="linenos">148</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="continuous_batches-149"><a href="#continuous_batches-149"><span class="linenos">149</span></a>    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="continuous_batches-150"><a href="#continuous_batches-150"><span class="linenos">150</span></a><span class="p">):</span>
</span><span id="continuous_batches-151"><a href="#continuous_batches-151"><span class="linenos">151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="continuous_batches-152"><a href="#continuous_batches-152"><span class="linenos">152</span></a><span class="sd">    Return the list of indices defining batches where consecutive arr values are True.</span>
</span><span id="continuous_batches-153"><a href="#continuous_batches-153"><span class="linenos">153</span></a>
</span><span id="continuous_batches-154"><a href="#continuous_batches-154"><span class="linenos">154</span></a><span class="sd">    Parameters</span>
</span><span id="continuous_batches-155"><a href="#continuous_batches-155"><span class="linenos">155</span></a><span class="sd">    ----------</span>
</span><span id="continuous_batches-156"><a href="#continuous_batches-156"><span class="linenos">156</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="continuous_batches-157"><a href="#continuous_batches-157"><span class="linenos">157</span></a><span class="sd">        A 1D boolean array.</span>
</span><span id="continuous_batches-158"><a href="#continuous_batches-158"><span class="linenos">158</span></a>
</span><span id="continuous_batches-159"><a href="#continuous_batches-159"><span class="linenos">159</span></a><span class="sd">    Returns</span>
</span><span id="continuous_batches-160"><a href="#continuous_batches-160"><span class="linenos">160</span></a><span class="sd">    -------</span>
</span><span id="continuous_batches-161"><a href="#continuous_batches-161"><span class="linenos">161</span></a><span class="sd">    list of list of int</span>
</span><span id="continuous_batches-162"><a href="#continuous_batches-162"><span class="linenos">162</span></a><span class="sd">        A list of lists containing the indices defining each batch of consecutive True values.</span>
</span><span id="continuous_batches-163"><a href="#continuous_batches-163"><span class="linenos">163</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="continuous_batches-164"><a href="#continuous_batches-164"><span class="linenos">164</span></a>    <span class="n">locs</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="continuous_batches-165"><a href="#continuous_batches-165"><span class="linenos">165</span></a>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
</span><span id="continuous_batches-166"><a href="#continuous_batches-166"><span class="linenos">166</span></a>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">idxs</span><span class="p">])</span>
</span><span id="continuous_batches-167"><a href="#continuous_batches-167"><span class="linenos">167</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">locs</span> <span class="o">+</span> <span class="n">idxs</span>
</span><span id="continuous_batches-168"><a href="#continuous_batches-168"><span class="linenos">168</span></a>    <span class="k">if</span> <span class="n">locs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="continuous_batches-169"><a href="#continuous_batches-169"><span class="linenos">169</span></a>        <span class="n">crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">crs</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="continuous_batches-170"><a href="#continuous_batches-170"><span class="linenos">170</span></a>    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="continuous_batches-171"><a href="#continuous_batches-171"><span class="linenos">171</span></a>    <span class="n">stops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">crs</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="continuous_batches-172"><a href="#continuous_batches-172"><span class="linenos">172</span></a>    <span class="n">batches</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">stops</span><span class="p">)]</span>
</span><span id="continuous_batches-173"><a href="#continuous_batches-173"><span class="linenos">173</span></a>
</span><span id="continuous_batches-174"><a href="#continuous_batches-174"><span class="linenos">174</span></a>    <span class="c1"># join those gaps separated by less than the provided tolerance</span>
</span><span id="continuous_batches-175"><a href="#continuous_batches-175"><span class="linenos">175</span></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="continuous_batches-176"><a href="#continuous_batches-176"><span class="linenos">176</span></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="continuous_batches-177"><a href="#continuous_batches-177"><span class="linenos">177</span></a>        <span class="k">if</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">:</span>
</span><span id="continuous_batches-178"><a href="#continuous_batches-178"><span class="linenos">178</span></a>            <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">batches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="continuous_batches-179"><a href="#continuous_batches-179"><span class="linenos">179</span></a>            <span class="n">batches</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="continuous_batches-180"><a href="#continuous_batches-180"><span class="linenos">180</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="continuous_batches-181"><a href="#continuous_batches-181"><span class="linenos">181</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="continuous_batches-182"><a href="#continuous_batches-182"><span class="linenos">182</span></a>
</span><span id="continuous_batches-183"><a href="#continuous_batches-183"><span class="linenos">183</span></a>    <span class="k">return</span> <span class="n">batches</span>
</span></pre></div>


            <div class="docstring"><p>Return the list of indices defining batches where consecutive arr values are True.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
A 1D boolean array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>list of list of int</strong>: A list of lists containing the indices defining each batch of consecutive True values.</li>
</ul>
</div>


                </section>
                <section id="nextpow">
                            <input id="nextpow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nextpow</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span>, </span><span class="param"><span class="n">base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="nextpow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#nextpow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="nextpow-186"><a href="#nextpow-186"><span class="linenos">186</span></a><span class="k">def</span><span class="w"> </span><span class="nf">nextpow</span><span class="p">(</span>
</span><span id="nextpow-187"><a href="#nextpow-187"><span class="linenos">187</span></a>    <span class="n">val</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="nextpow-188"><a href="#nextpow-188"><span class="linenos">188</span></a>    <span class="n">base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="nextpow-189"><a href="#nextpow-189"><span class="linenos">189</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="nextpow-190"><a href="#nextpow-190"><span class="linenos">190</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="nextpow-191"><a href="#nextpow-191"><span class="linenos">191</span></a><span class="sd">    Get the next power of the provided value according to the given base.</span>
</span><span id="nextpow-192"><a href="#nextpow-192"><span class="linenos">192</span></a>
</span><span id="nextpow-193"><a href="#nextpow-193"><span class="linenos">193</span></a><span class="sd">    Parameters</span>
</span><span id="nextpow-194"><a href="#nextpow-194"><span class="linenos">194</span></a><span class="sd">    ----------</span>
</span><span id="nextpow-195"><a href="#nextpow-195"><span class="linenos">195</span></a><span class="sd">    val : int or float</span>
</span><span id="nextpow-196"><a href="#nextpow-196"><span class="linenos">196</span></a><span class="sd">        The target value.</span>
</span><span id="nextpow-197"><a href="#nextpow-197"><span class="linenos">197</span></a><span class="sd">    base : int, optional</span>
</span><span id="nextpow-198"><a href="#nextpow-198"><span class="linenos">198</span></a><span class="sd">        The base to be elevated.</span>
</span><span id="nextpow-199"><a href="#nextpow-199"><span class="linenos">199</span></a>
</span><span id="nextpow-200"><a href="#nextpow-200"><span class="linenos">200</span></a><span class="sd">    Returns</span>
</span><span id="nextpow-201"><a href="#nextpow-201"><span class="linenos">201</span></a><span class="sd">    -------</span>
</span><span id="nextpow-202"><a href="#nextpow-202"><span class="linenos">202</span></a><span class="sd">    int</span>
</span><span id="nextpow-203"><a href="#nextpow-203"><span class="linenos">203</span></a><span class="sd">        The next power of the provided value according to the given base.</span>
</span><span id="nextpow-204"><a href="#nextpow-204"><span class="linenos">204</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="nextpow-205"><a href="#nextpow-205"><span class="linenos">205</span></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">base</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="p">))))</span>
</span></pre></div>


            <div class="docstring"><p>Get the next power of the provided value according to the given base.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>val</strong> (int or float):
The target value.</li>
<li><strong>base</strong> (int, optional):
The base to be elevated.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>int</strong>: The next power of the provided value according to the given base.</li>
</ul>
</div>


                </section>
                <section id="winter_derivative1">
                            <input id="winter_derivative1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">winter_derivative1</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">y_signal</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">x_signal</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="winter_derivative1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#winter_derivative1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="winter_derivative1-208"><a href="#winter_derivative1-208"><span class="linenos">208</span></a><span class="k">def</span><span class="w"> </span><span class="nf">winter_derivative1</span><span class="p">(</span>
</span><span id="winter_derivative1-209"><a href="#winter_derivative1-209"><span class="linenos">209</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="winter_derivative1-210"><a href="#winter_derivative1-210"><span class="linenos">210</span></a>    <span class="n">x_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="winter_derivative1-211"><a href="#winter_derivative1-211"><span class="linenos">211</span></a>    <span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="winter_derivative1-212"><a href="#winter_derivative1-212"><span class="linenos">212</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="winter_derivative1-213"><a href="#winter_derivative1-213"><span class="linenos">213</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="winter_derivative1-214"><a href="#winter_derivative1-214"><span class="linenos">214</span></a><span class="sd">    Return the first derivative of y.</span>
</span><span id="winter_derivative1-215"><a href="#winter_derivative1-215"><span class="linenos">215</span></a>
</span><span id="winter_derivative1-216"><a href="#winter_derivative1-216"><span class="linenos">216</span></a><span class="sd">    Parameters</span>
</span><span id="winter_derivative1-217"><a href="#winter_derivative1-217"><span class="linenos">217</span></a><span class="sd">    ----------</span>
</span><span id="winter_derivative1-218"><a href="#winter_derivative1-218"><span class="linenos">218</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="winter_derivative1-219"><a href="#winter_derivative1-219"><span class="linenos">219</span></a><span class="sd">        The signal to be differentiated.</span>
</span><span id="winter_derivative1-220"><a href="#winter_derivative1-220"><span class="linenos">220</span></a><span class="sd">    x_signal : np.ndarray or None, optional</span>
</span><span id="winter_derivative1-221"><a href="#winter_derivative1-221"><span class="linenos">221</span></a><span class="sd">        The optional signal from which y has to be differentiated (default: None).</span>
</span><span id="winter_derivative1-222"><a href="#winter_derivative1-222"><span class="linenos">222</span></a><span class="sd">    time_diff : float or int, optional</span>
</span><span id="winter_derivative1-223"><a href="#winter_derivative1-223"><span class="linenos">223</span></a><span class="sd">        The difference between samples in y. Ignored if x_signal is provided.</span>
</span><span id="winter_derivative1-224"><a href="#winter_derivative1-224"><span class="linenos">224</span></a>
</span><span id="winter_derivative1-225"><a href="#winter_derivative1-225"><span class="linenos">225</span></a><span class="sd">    Returns</span>
</span><span id="winter_derivative1-226"><a href="#winter_derivative1-226"><span class="linenos">226</span></a><span class="sd">    -------</span>
</span><span id="winter_derivative1-227"><a href="#winter_derivative1-227"><span class="linenos">227</span></a><span class="sd">    np.ndarray</span>
</span><span id="winter_derivative1-228"><a href="#winter_derivative1-228"><span class="linenos">228</span></a><span class="sd">        The first derivative of y.</span>
</span><span id="winter_derivative1-229"><a href="#winter_derivative1-229"><span class="linenos">229</span></a>
</span><span id="winter_derivative1-230"><a href="#winter_derivative1-230"><span class="linenos">230</span></a><span class="sd">    References</span>
</span><span id="winter_derivative1-231"><a href="#winter_derivative1-231"><span class="linenos">231</span></a><span class="sd">    ----------</span>
</span><span id="winter_derivative1-232"><a href="#winter_derivative1-232"><span class="linenos">232</span></a><span class="sd">    Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</span>
</span><span id="winter_derivative1-233"><a href="#winter_derivative1-233"><span class="linenos">233</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="winter_derivative1-234"><a href="#winter_derivative1-234"><span class="linenos">234</span></a>
</span><span id="winter_derivative1-235"><a href="#winter_derivative1-235"><span class="linenos">235</span></a>    <span class="c1"># get x</span>
</span><span id="winter_derivative1-236"><a href="#winter_derivative1-236"><span class="linenos">236</span></a>    <span class="k">if</span> <span class="n">x_signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="winter_derivative1-237"><a href="#winter_derivative1-237"><span class="linenos">237</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">))</span> <span class="o">*</span> <span class="n">time_diff</span>
</span><span id="winter_derivative1-238"><a href="#winter_derivative1-238"><span class="linenos">238</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="winter_derivative1-239"><a href="#winter_derivative1-239"><span class="linenos">239</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">x_signal</span>
</span><span id="winter_derivative1-240"><a href="#winter_derivative1-240"><span class="linenos">240</span></a>
</span><span id="winter_derivative1-241"><a href="#winter_derivative1-241"><span class="linenos">241</span></a>    <span class="c1"># get the derivative</span>
</span><span id="winter_derivative1-242"><a href="#winter_derivative1-242"><span class="linenos">242</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">y_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">y_signal</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_sig</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">x_sig</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return the first derivative of y.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>y_signal</strong> (np.ndarray):
The signal to be differentiated.</li>
<li><strong>x_signal</strong> (np.ndarray or None, optional):
The optional signal from which y has to be differentiated (default: None).</li>
<li><strong>time_diff</strong> (float or int, optional):
The difference between samples in y. Ignored if x_signal is provided.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The first derivative of y.</li>
</ul>

<h6 id="references">References</h6>

<p>Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</p>
</div>


                </section>
                <section id="winter_derivative2">
                            <input id="winter_derivative2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">winter_derivative2</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">y_signal</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">x_signal</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="winter_derivative2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#winter_derivative2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="winter_derivative2-245"><a href="#winter_derivative2-245"><span class="linenos">245</span></a><span class="k">def</span><span class="w"> </span><span class="nf">winter_derivative2</span><span class="p">(</span>
</span><span id="winter_derivative2-246"><a href="#winter_derivative2-246"><span class="linenos">246</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="winter_derivative2-247"><a href="#winter_derivative2-247"><span class="linenos">247</span></a>    <span class="n">x_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="winter_derivative2-248"><a href="#winter_derivative2-248"><span class="linenos">248</span></a>    <span class="n">time_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="winter_derivative2-249"><a href="#winter_derivative2-249"><span class="linenos">249</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="winter_derivative2-250"><a href="#winter_derivative2-250"><span class="linenos">250</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="winter_derivative2-251"><a href="#winter_derivative2-251"><span class="linenos">251</span></a><span class="sd">    Return the second derivative of y.</span>
</span><span id="winter_derivative2-252"><a href="#winter_derivative2-252"><span class="linenos">252</span></a>
</span><span id="winter_derivative2-253"><a href="#winter_derivative2-253"><span class="linenos">253</span></a><span class="sd">    Parameters</span>
</span><span id="winter_derivative2-254"><a href="#winter_derivative2-254"><span class="linenos">254</span></a><span class="sd">    ----------</span>
</span><span id="winter_derivative2-255"><a href="#winter_derivative2-255"><span class="linenos">255</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="winter_derivative2-256"><a href="#winter_derivative2-256"><span class="linenos">256</span></a><span class="sd">        The signal to be differentiated.</span>
</span><span id="winter_derivative2-257"><a href="#winter_derivative2-257"><span class="linenos">257</span></a><span class="sd">    x_signal : np.ndarray or None, optional</span>
</span><span id="winter_derivative2-258"><a href="#winter_derivative2-258"><span class="linenos">258</span></a><span class="sd">        The optional signal from which y has to be differentiated (default: None).</span>
</span><span id="winter_derivative2-259"><a href="#winter_derivative2-259"><span class="linenos">259</span></a><span class="sd">    time_diff : float or int, optional</span>
</span><span id="winter_derivative2-260"><a href="#winter_derivative2-260"><span class="linenos">260</span></a><span class="sd">        The difference between samples in y. Ignored if x_signal is provided.</span>
</span><span id="winter_derivative2-261"><a href="#winter_derivative2-261"><span class="linenos">261</span></a>
</span><span id="winter_derivative2-262"><a href="#winter_derivative2-262"><span class="linenos">262</span></a><span class="sd">    Returns</span>
</span><span id="winter_derivative2-263"><a href="#winter_derivative2-263"><span class="linenos">263</span></a><span class="sd">    -------</span>
</span><span id="winter_derivative2-264"><a href="#winter_derivative2-264"><span class="linenos">264</span></a><span class="sd">    np.ndarray</span>
</span><span id="winter_derivative2-265"><a href="#winter_derivative2-265"><span class="linenos">265</span></a><span class="sd">        The second derivative of y.</span>
</span><span id="winter_derivative2-266"><a href="#winter_derivative2-266"><span class="linenos">266</span></a>
</span><span id="winter_derivative2-267"><a href="#winter_derivative2-267"><span class="linenos">267</span></a><span class="sd">    References</span>
</span><span id="winter_derivative2-268"><a href="#winter_derivative2-268"><span class="linenos">268</span></a><span class="sd">    ----------</span>
</span><span id="winter_derivative2-269"><a href="#winter_derivative2-269"><span class="linenos">269</span></a><span class="sd">    Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</span>
</span><span id="winter_derivative2-270"><a href="#winter_derivative2-270"><span class="linenos">270</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="winter_derivative2-271"><a href="#winter_derivative2-271"><span class="linenos">271</span></a>
</span><span id="winter_derivative2-272"><a href="#winter_derivative2-272"><span class="linenos">272</span></a>    <span class="c1"># get x</span>
</span><span id="winter_derivative2-273"><a href="#winter_derivative2-273"><span class="linenos">273</span></a>    <span class="k">if</span> <span class="n">x_signal</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="winter_derivative2-274"><a href="#winter_derivative2-274"><span class="linenos">274</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">))</span> <span class="o">*</span> <span class="n">time_diff</span>
</span><span id="winter_derivative2-275"><a href="#winter_derivative2-275"><span class="linenos">275</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="winter_derivative2-276"><a href="#winter_derivative2-276"><span class="linenos">276</span></a>        <span class="n">x_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x_signal</span><span class="p">)</span>
</span><span id="winter_derivative2-277"><a href="#winter_derivative2-277"><span class="linenos">277</span></a>
</span><span id="winter_derivative2-278"><a href="#winter_derivative2-278"><span class="linenos">278</span></a>    <span class="c1"># get the derivative</span>
</span><span id="winter_derivative2-279"><a href="#winter_derivative2-279"><span class="linenos">279</span></a>    <span class="n">num</span> <span class="o">=</span> <span class="n">y_signal</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">y_signal</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y_signal</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="winter_derivative2-280"><a href="#winter_derivative2-280"><span class="linenos">280</span></a>    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_sig</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="winter_derivative2-281"><a href="#winter_derivative2-281"><span class="linenos">281</span></a>    <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>
</span></pre></div>


            <div class="docstring"><p>Return the second derivative of y.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>y_signal</strong> (np.ndarray):
The signal to be differentiated.</li>
<li><strong>x_signal</strong> (np.ndarray or None, optional):
The optional signal from which y has to be differentiated (default: None).</li>
<li><strong>time_diff</strong> (float or int, optional):
The difference between samples in y. Ignored if x_signal is provided.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The second derivative of y.</li>
</ul>

<h6 id="references">References</h6>

<p>Winter DA. Biomechanics and Motor Control of Human Movement. Fourth Ed. Hoboken, New Jersey: John Wiley &amp; Sons Inc; 2009.</p>
</div>


                </section>
                <section id="freedman_diaconis_bins">
                            <input id="freedman_diaconis_bins-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">freedman_diaconis_bins</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">y_signal</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="freedman_diaconis_bins-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#freedman_diaconis_bins"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="freedman_diaconis_bins-284"><a href="#freedman_diaconis_bins-284"><span class="linenos">284</span></a><span class="k">def</span><span class="w"> </span><span class="nf">freedman_diaconis_bins</span><span class="p">(</span>
</span><span id="freedman_diaconis_bins-285"><a href="#freedman_diaconis_bins-285"><span class="linenos">285</span></a>    <span class="n">y_signal</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="freedman_diaconis_bins-286"><a href="#freedman_diaconis_bins-286"><span class="linenos">286</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="freedman_diaconis_bins-287"><a href="#freedman_diaconis_bins-287"><span class="linenos">287</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="freedman_diaconis_bins-288"><a href="#freedman_diaconis_bins-288"><span class="linenos">288</span></a><span class="sd">    Digitize a 1D signal in bins defined according to the Freedman-Diaconis rule.</span>
</span><span id="freedman_diaconis_bins-289"><a href="#freedman_diaconis_bins-289"><span class="linenos">289</span></a>
</span><span id="freedman_diaconis_bins-290"><a href="#freedman_diaconis_bins-290"><span class="linenos">290</span></a><span class="sd">    Parameters</span>
</span><span id="freedman_diaconis_bins-291"><a href="#freedman_diaconis_bins-291"><span class="linenos">291</span></a><span class="sd">    ----------</span>
</span><span id="freedman_diaconis_bins-292"><a href="#freedman_diaconis_bins-292"><span class="linenos">292</span></a><span class="sd">    y_signal : np.ndarray</span>
</span><span id="freedman_diaconis_bins-293"><a href="#freedman_diaconis_bins-293"><span class="linenos">293</span></a><span class="sd">        The signal to be digitized.</span>
</span><span id="freedman_diaconis_bins-294"><a href="#freedman_diaconis_bins-294"><span class="linenos">294</span></a>
</span><span id="freedman_diaconis_bins-295"><a href="#freedman_diaconis_bins-295"><span class="linenos">295</span></a><span class="sd">    Returns</span>
</span><span id="freedman_diaconis_bins-296"><a href="#freedman_diaconis_bins-296"><span class="linenos">296</span></a><span class="sd">    -------</span>
</span><span id="freedman_diaconis_bins-297"><a href="#freedman_diaconis_bins-297"><span class="linenos">297</span></a><span class="sd">    np.ndarray</span>
</span><span id="freedman_diaconis_bins-298"><a href="#freedman_diaconis_bins-298"><span class="linenos">298</span></a><span class="sd">        An array with the same shape as y containing the index of the bin for each sample.</span>
</span><span id="freedman_diaconis_bins-299"><a href="#freedman_diaconis_bins-299"><span class="linenos">299</span></a>
</span><span id="freedman_diaconis_bins-300"><a href="#freedman_diaconis_bins-300"><span class="linenos">300</span></a><span class="sd">    References</span>
</span><span id="freedman_diaconis_bins-301"><a href="#freedman_diaconis_bins-301"><span class="linenos">301</span></a><span class="sd">    ----------</span>
</span><span id="freedman_diaconis_bins-302"><a href="#freedman_diaconis_bins-302"><span class="linenos">302</span></a><span class="sd">    Freedman D, Diaconis P. (1981) On the histogram as a density estimator: L2 theory. Z. Wahrscheinlichkeitstheorie verw Gebiete 57: 453-476. doi: 10.1007/BF01025868</span>
</span><span id="freedman_diaconis_bins-303"><a href="#freedman_diaconis_bins-303"><span class="linenos">303</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="freedman_diaconis_bins-304"><a href="#freedman_diaconis_bins-304"><span class="linenos">304</span></a>
</span><span id="freedman_diaconis_bins-305"><a href="#freedman_diaconis_bins-305"><span class="linenos">305</span></a>    <span class="c1"># y IQR</span>
</span><span id="freedman_diaconis_bins-306"><a href="#freedman_diaconis_bins-306"><span class="linenos">306</span></a>    <span class="n">qnt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y_signal</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span id="freedman_diaconis_bins-307"><a href="#freedman_diaconis_bins-307"><span class="linenos">307</span></a>    <span class="n">qnt3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">y_signal</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
</span><span id="freedman_diaconis_bins-308"><a href="#freedman_diaconis_bins-308"><span class="linenos">308</span></a>    <span class="n">iqr</span> <span class="o">=</span> <span class="n">qnt3</span> <span class="o">-</span> <span class="n">qnt1</span>
</span><span id="freedman_diaconis_bins-309"><a href="#freedman_diaconis_bins-309"><span class="linenos">309</span></a>
</span><span id="freedman_diaconis_bins-310"><a href="#freedman_diaconis_bins-310"><span class="linenos">310</span></a>    <span class="c1"># get the width</span>
</span><span id="freedman_diaconis_bins-311"><a href="#freedman_diaconis_bins-311"><span class="linenos">311</span></a>    <span class="n">wdt</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">iqr</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_signal</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="freedman_diaconis_bins-312"><a href="#freedman_diaconis_bins-312"><span class="linenos">312</span></a>
</span><span id="freedman_diaconis_bins-313"><a href="#freedman_diaconis_bins-313"><span class="linenos">313</span></a>    <span class="c1"># get the number of intervals</span>
</span><span id="freedman_diaconis_bins-314"><a href="#freedman_diaconis_bins-314"><span class="linenos">314</span></a>    <span class="n">samp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">wdt</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="freedman_diaconis_bins-315"><a href="#freedman_diaconis_bins-315"><span class="linenos">315</span></a>
</span><span id="freedman_diaconis_bins-316"><a href="#freedman_diaconis_bins-316"><span class="linenos">316</span></a>    <span class="c1"># digitize z</span>
</span><span id="freedman_diaconis_bins-317"><a href="#freedman_diaconis_bins-317"><span class="linenos">317</span></a>    <span class="n">digitized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">y_signal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="freedman_diaconis_bins-318"><a href="#freedman_diaconis_bins-318"><span class="linenos">318</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">samp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="freedman_diaconis_bins-319"><a href="#freedman_diaconis_bins-319"><span class="linenos">319</span></a>        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">((</span><span class="n">y_signal</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">wdt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_signal</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">wdt</span><span class="p">))</span>
</span><span id="freedman_diaconis_bins-320"><a href="#freedman_diaconis_bins-320"><span class="linenos">320</span></a>        <span class="n">digitized</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="freedman_diaconis_bins-321"><a href="#freedman_diaconis_bins-321"><span class="linenos">321</span></a>    <span class="k">return</span> <span class="n">digitized</span>
</span></pre></div>


            <div class="docstring"><p>Digitize a 1D signal in bins defined according to the Freedman-Diaconis rule.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>y_signal</strong> (np.ndarray):
The signal to be digitized.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: An array with the same shape as y containing the index of the bin for each sample.</li>
</ul>

<h6 id="references">References</h6>

<p>Freedman D, Diaconis P. (1981) On the histogram as a density estimator: L2 theory. Z. Wahrscheinlichkeitstheorie verw Gebiete 57: 453-476. doi: 10.1007/BF01025868</p>
</div>


                </section>
                <section id="fir_filt">
                            <input id="fir_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fir_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">,</span> <span class="s1">&#39;highpass&#39;</span><span class="p">,</span> <span class="s1">&#39;bandpass&#39;</span><span class="p">,</span> <span class="s1">&#39;bandstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lowpass&#39;</span>,</span><span class="param">	<span class="n">wtype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;boxcar&#39;</span><span class="p">,</span> <span class="s1">&#39;triang&#39;</span><span class="p">,</span> <span class="s1">&#39;blackman&#39;</span><span class="p">,</span> <span class="s1">&#39;hamming&#39;</span><span class="p">,</span> <span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="s1">&#39;bartlett&#39;</span><span class="p">,</span> <span class="s1">&#39;flattop&#39;</span><span class="p">,</span> <span class="s1">&#39;parzen&#39;</span><span class="p">,</span> <span class="s1">&#39;bohman&#39;</span><span class="p">,</span> <span class="s1">&#39;blackmanharris&#39;</span><span class="p">,</span> <span class="s1">&#39;nuttall&#39;</span><span class="p">,</span> <span class="s1">&#39;barthann&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;exponential&#39;</span><span class="p">,</span> <span class="s1">&#39;tukey&#39;</span><span class="p">,</span> <span class="s1">&#39;taylor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hamming&#39;</span>,</span><span class="param">	<span class="n">pstyle</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;linear_ramp&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="s1">&#39;symmetric&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="fir_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fir_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fir_filt-539"><a href="#fir_filt-539"><span class="linenos">539</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fir_filt</span><span class="p">(</span>
</span><span id="fir_filt-540"><a href="#fir_filt-540"><span class="linenos">540</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="fir_filt-541"><a href="#fir_filt-541"><span class="linenos">541</span></a>    <span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="fir_filt-542"><a href="#fir_filt-542"><span class="linenos">542</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="fir_filt-543"><a href="#fir_filt-543"><span class="linenos">543</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="fir_filt-544"><a href="#fir_filt-544"><span class="linenos">544</span></a>    <span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;lowpass&quot;</span><span class="p">,</span> <span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandstop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lowpass&quot;</span><span class="p">,</span>
</span><span id="fir_filt-545"><a href="#fir_filt-545"><span class="linenos">545</span></a>    <span class="n">wtype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="fir_filt-546"><a href="#fir_filt-546"><span class="linenos">546</span></a>        <span class="s2">&quot;boxcar&quot;</span><span class="p">,</span>
</span><span id="fir_filt-547"><a href="#fir_filt-547"><span class="linenos">547</span></a>        <span class="s2">&quot;triang&quot;</span><span class="p">,</span>
</span><span id="fir_filt-548"><a href="#fir_filt-548"><span class="linenos">548</span></a>        <span class="s2">&quot;blackman&quot;</span><span class="p">,</span>
</span><span id="fir_filt-549"><a href="#fir_filt-549"><span class="linenos">549</span></a>        <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
</span><span id="fir_filt-550"><a href="#fir_filt-550"><span class="linenos">550</span></a>        <span class="s2">&quot;hann&quot;</span><span class="p">,</span>
</span><span id="fir_filt-551"><a href="#fir_filt-551"><span class="linenos">551</span></a>        <span class="s2">&quot;bartlett&quot;</span><span class="p">,</span>
</span><span id="fir_filt-552"><a href="#fir_filt-552"><span class="linenos">552</span></a>        <span class="s2">&quot;flattop&quot;</span><span class="p">,</span>
</span><span id="fir_filt-553"><a href="#fir_filt-553"><span class="linenos">553</span></a>        <span class="s2">&quot;parzen&quot;</span><span class="p">,</span>
</span><span id="fir_filt-554"><a href="#fir_filt-554"><span class="linenos">554</span></a>        <span class="s2">&quot;bohman&quot;</span><span class="p">,</span>
</span><span id="fir_filt-555"><a href="#fir_filt-555"><span class="linenos">555</span></a>        <span class="s2">&quot;blackmanharris&quot;</span><span class="p">,</span>
</span><span id="fir_filt-556"><a href="#fir_filt-556"><span class="linenos">556</span></a>        <span class="s2">&quot;nuttall&quot;</span><span class="p">,</span>
</span><span id="fir_filt-557"><a href="#fir_filt-557"><span class="linenos">557</span></a>        <span class="s2">&quot;barthann&quot;</span><span class="p">,</span>
</span><span id="fir_filt-558"><a href="#fir_filt-558"><span class="linenos">558</span></a>        <span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
</span><span id="fir_filt-559"><a href="#fir_filt-559"><span class="linenos">559</span></a>        <span class="s2">&quot;exponential&quot;</span><span class="p">,</span>
</span><span id="fir_filt-560"><a href="#fir_filt-560"><span class="linenos">560</span></a>        <span class="s2">&quot;tukey&quot;</span><span class="p">,</span>
</span><span id="fir_filt-561"><a href="#fir_filt-561"><span class="linenos">561</span></a>        <span class="s2">&quot;taylor&quot;</span><span class="p">,</span>
</span><span id="fir_filt-562"><a href="#fir_filt-562"><span class="linenos">562</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hamming&quot;</span><span class="p">,</span>
</span><span id="fir_filt-563"><a href="#fir_filt-563"><span class="linenos">563</span></a>    <span class="n">pstyle</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="fir_filt-564"><a href="#fir_filt-564"><span class="linenos">564</span></a>        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
</span><span id="fir_filt-565"><a href="#fir_filt-565"><span class="linenos">565</span></a>        <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="fir_filt-566"><a href="#fir_filt-566"><span class="linenos">566</span></a>        <span class="s2">&quot;linear_ramp&quot;</span><span class="p">,</span>
</span><span id="fir_filt-567"><a href="#fir_filt-567"><span class="linenos">567</span></a>        <span class="s2">&quot;maximum&quot;</span><span class="p">,</span>
</span><span id="fir_filt-568"><a href="#fir_filt-568"><span class="linenos">568</span></a>        <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
</span><span id="fir_filt-569"><a href="#fir_filt-569"><span class="linenos">569</span></a>        <span class="s2">&quot;median&quot;</span><span class="p">,</span>
</span><span id="fir_filt-570"><a href="#fir_filt-570"><span class="linenos">570</span></a>        <span class="s2">&quot;minimum&quot;</span><span class="p">,</span>
</span><span id="fir_filt-571"><a href="#fir_filt-571"><span class="linenos">571</span></a>        <span class="s2">&quot;reflect&quot;</span><span class="p">,</span>
</span><span id="fir_filt-572"><a href="#fir_filt-572"><span class="linenos">572</span></a>        <span class="s2">&quot;symmetric&quot;</span><span class="p">,</span>
</span><span id="fir_filt-573"><a href="#fir_filt-573"><span class="linenos">573</span></a>        <span class="s2">&quot;wrap&quot;</span><span class="p">,</span>
</span><span id="fir_filt-574"><a href="#fir_filt-574"><span class="linenos">574</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="fir_filt-575"><a href="#fir_filt-575"><span class="linenos">575</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="fir_filt-576"><a href="#fir_filt-576"><span class="linenos">576</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fir_filt-577"><a href="#fir_filt-577"><span class="linenos">577</span></a><span class="sd">    Apply a FIR filter with the specified specs to the signal.</span>
</span><span id="fir_filt-578"><a href="#fir_filt-578"><span class="linenos">578</span></a>
</span><span id="fir_filt-579"><a href="#fir_filt-579"><span class="linenos">579</span></a><span class="sd">    Parameters</span>
</span><span id="fir_filt-580"><a href="#fir_filt-580"><span class="linenos">580</span></a><span class="sd">    ----------</span>
</span><span id="fir_filt-581"><a href="#fir_filt-581"><span class="linenos">581</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="fir_filt-582"><a href="#fir_filt-582"><span class="linenos">582</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="fir_filt-583"><a href="#fir_filt-583"><span class="linenos">583</span></a><span class="sd">    fcut : float, int, list, or tuple, optional</span>
</span><span id="fir_filt-584"><a href="#fir_filt-584"><span class="linenos">584</span></a><span class="sd">        The cutoff frequency of the filter.</span>
</span><span id="fir_filt-585"><a href="#fir_filt-585"><span class="linenos">585</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="fir_filt-586"><a href="#fir_filt-586"><span class="linenos">586</span></a><span class="sd">        The sampling frequency of the signal.</span>
</span><span id="fir_filt-587"><a href="#fir_filt-587"><span class="linenos">587</span></a><span class="sd">    order : int, optional</span>
</span><span id="fir_filt-588"><a href="#fir_filt-588"><span class="linenos">588</span></a><span class="sd">        The order of the filter.</span>
</span><span id="fir_filt-589"><a href="#fir_filt-589"><span class="linenos">589</span></a><span class="sd">    ftype : str, optional</span>
</span><span id="fir_filt-590"><a href="#fir_filt-590"><span class="linenos">590</span></a><span class="sd">        The type of filter: &quot;bandpass&quot;, &quot;lowpass&quot;, &quot;highpass&quot;, &quot;bandstop&quot;.</span>
</span><span id="fir_filt-591"><a href="#fir_filt-591"><span class="linenos">591</span></a><span class="sd">    wtype : str, optional</span>
</span><span id="fir_filt-592"><a href="#fir_filt-592"><span class="linenos">592</span></a><span class="sd">        The type of window to be applied.</span>
</span><span id="fir_filt-593"><a href="#fir_filt-593"><span class="linenos">593</span></a><span class="sd">    pstyle : str, optional</span>
</span><span id="fir_filt-594"><a href="#fir_filt-594"><span class="linenos">594</span></a><span class="sd">        The type of padding style.</span>
</span><span id="fir_filt-595"><a href="#fir_filt-595"><span class="linenos">595</span></a>
</span><span id="fir_filt-596"><a href="#fir_filt-596"><span class="linenos">596</span></a><span class="sd">    Returns</span>
</span><span id="fir_filt-597"><a href="#fir_filt-597"><span class="linenos">597</span></a><span class="sd">    -------</span>
</span><span id="fir_filt-598"><a href="#fir_filt-598"><span class="linenos">598</span></a><span class="sd">    np.ndarray</span>
</span><span id="fir_filt-599"><a href="#fir_filt-599"><span class="linenos">599</span></a><span class="sd">        The filtered signal.</span>
</span><span id="fir_filt-600"><a href="#fir_filt-600"><span class="linenos">600</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fir_filt-601"><a href="#fir_filt-601"><span class="linenos">601</span></a>    <span class="n">coefs</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">firwin</span><span class="p">(</span>
</span><span id="fir_filt-602"><a href="#fir_filt-602"><span class="linenos">602</span></a>        <span class="n">order</span><span class="p">,</span>
</span><span id="fir_filt-603"><a href="#fir_filt-603"><span class="linenos">603</span></a>        <span class="n">fcut</span><span class="p">,</span>
</span><span id="fir_filt-604"><a href="#fir_filt-604"><span class="linenos">604</span></a>        <span class="n">window</span><span class="o">=</span><span class="n">wtype</span><span class="p">,</span>
</span><span id="fir_filt-605"><a href="#fir_filt-605"><span class="linenos">605</span></a>        <span class="n">pass_zero</span><span class="o">=</span><span class="n">ftype</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="fir_filt-606"><a href="#fir_filt-606"><span class="linenos">606</span></a>        <span class="n">fs</span><span class="o">=</span><span class="n">fsamp</span><span class="p">,</span>
</span><span id="fir_filt-607"><a href="#fir_filt-607"><span class="linenos">607</span></a>    <span class="p">)</span>
</span><span id="fir_filt-608"><a href="#fir_filt-608"><span class="linenos">608</span></a>    <span class="n">val</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pstyle</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="fir_filt-609"><a href="#fir_filt-609"><span class="linenos">609</span></a>    <span class="n">padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="fir_filt-610"><a href="#fir_filt-610"><span class="linenos">610</span></a>        <span class="n">arr</span><span class="p">,</span>
</span><span id="fir_filt-611"><a href="#fir_filt-611"><span class="linenos">611</span></a>        <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="fir_filt-612"><a href="#fir_filt-612"><span class="linenos">612</span></a>        <span class="n">mode</span><span class="o">=</span><span class="n">pstyle</span><span class="p">,</span>
</span><span id="fir_filt-613"><a href="#fir_filt-613"><span class="linenos">613</span></a>        <span class="n">constant_values</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
</span><span id="fir_filt-614"><a href="#fir_filt-614"><span class="linenos">614</span></a>    <span class="p">)</span>
</span><span id="fir_filt-615"><a href="#fir_filt-615"><span class="linenos">615</span></a>    <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span>
</span><span id="fir_filt-616"><a href="#fir_filt-616"><span class="linenos">616</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lfilter</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">padded</span> <span class="o">-</span> <span class="n">avg</span><span class="p">)[(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">order</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="fir_filt-617"><a href="#fir_filt-617"><span class="linenos">617</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">avg</span>
</span></pre></div>


            <div class="docstring"><p>Apply a FIR filter with the specified specs to the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>fcut</strong> (float, int, list, or tuple, optional):
The cutoff frequency of the filter.</li>
<li><strong>fsamp</strong> (float or int, optional):
The sampling frequency of the signal.</li>
<li><strong>order</strong> (int, optional):
The order of the filter.</li>
<li><strong>ftype</strong> (str, optional):
The type of filter: "bandpass", "lowpass", "highpass", "bandstop".</li>
<li><strong>wtype</strong> (str, optional):
The type of window to be applied.</li>
<li><strong>pstyle</strong> (str, optional):
The type of padding style.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="padwin">
                            <input id="padwin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">padwin</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="padwin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#padwin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="padwin-324"><a href="#padwin-324"><span class="linenos">324</span></a><span class="k">def</span><span class="w"> </span><span class="nf">padwin</span><span class="p">(</span>
</span><span id="padwin-325"><a href="#padwin-325"><span class="linenos">325</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="padwin-326"><a href="#padwin-326"><span class="linenos">326</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="padwin-327"><a href="#padwin-327"><span class="linenos">327</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="padwin-328"><a href="#padwin-328"><span class="linenos">328</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="padwin-329"><a href="#padwin-329"><span class="linenos">329</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="padwin-330"><a href="#padwin-330"><span class="linenos">330</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="padwin-331"><a href="#padwin-331"><span class="linenos">331</span></a><span class="sd">    Pad the signal according to the given order and return the mask of indices defining each window on the signal.</span>
</span><span id="padwin-332"><a href="#padwin-332"><span class="linenos">332</span></a>
</span><span id="padwin-333"><a href="#padwin-333"><span class="linenos">333</span></a><span class="sd">    Parameters</span>
</span><span id="padwin-334"><a href="#padwin-334"><span class="linenos">334</span></a><span class="sd">    ----------</span>
</span><span id="padwin-335"><a href="#padwin-335"><span class="linenos">335</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="padwin-336"><a href="#padwin-336"><span class="linenos">336</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="padwin-337"><a href="#padwin-337"><span class="linenos">337</span></a><span class="sd">    order : int, optional</span>
</span><span id="padwin-338"><a href="#padwin-338"><span class="linenos">338</span></a><span class="sd">        The number of samples to be considered as averaging window.</span>
</span><span id="padwin-339"><a href="#padwin-339"><span class="linenos">339</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="padwin-340"><a href="#padwin-340"><span class="linenos">340</span></a><span class="sd">        The type of padding style adopted before filtering.</span>
</span><span id="padwin-341"><a href="#padwin-341"><span class="linenos">341</span></a><span class="sd">    offset : float, optional</span>
</span><span id="padwin-342"><a href="#padwin-342"><span class="linenos">342</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="padwin-343"><a href="#padwin-343"><span class="linenos">343</span></a>
</span><span id="padwin-344"><a href="#padwin-344"><span class="linenos">344</span></a><span class="sd">    Returns</span>
</span><span id="padwin-345"><a href="#padwin-345"><span class="linenos">345</span></a><span class="sd">    -------</span>
</span><span id="padwin-346"><a href="#padwin-346"><span class="linenos">346</span></a><span class="sd">    pad : np.ndarray</span>
</span><span id="padwin-347"><a href="#padwin-347"><span class="linenos">347</span></a><span class="sd">        The padded signal.</span>
</span><span id="padwin-348"><a href="#padwin-348"><span class="linenos">348</span></a><span class="sd">    mask : np.ndarray</span>
</span><span id="padwin-349"><a href="#padwin-349"><span class="linenos">349</span></a><span class="sd">        A 2D mask where each row denotes the indices of one window on the signal.</span>
</span><span id="padwin-350"><a href="#padwin-350"><span class="linenos">350</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="padwin-351"><a href="#padwin-351"><span class="linenos">351</span></a>    <span class="c1"># get the window range</span>
</span><span id="padwin-352"><a href="#padwin-352"><span class="linenos">352</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="padwin-353"><a href="#padwin-353"><span class="linenos">353</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">stop</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="padwin-354"><a href="#padwin-354"><span class="linenos">354</span></a>
</span><span id="padwin-355"><a href="#padwin-355"><span class="linenos">355</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="padwin-356"><a href="#padwin-356"><span class="linenos">356</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="padwin-357"><a href="#padwin-357"><span class="linenos">357</span></a>
</span><span id="padwin-358"><a href="#padwin-358"><span class="linenos">358</span></a>    <span class="c1"># padding</span>
</span><span id="padwin-359"><a href="#padwin-359"><span class="linenos">359</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="padwin-360"><a href="#padwin-360"><span class="linenos">360</span></a>
</span><span id="padwin-361"><a href="#padwin-361"><span class="linenos">361</span></a>    <span class="c1"># get the windows mask</span>
</span><span id="padwin-362"><a href="#padwin-362"><span class="linenos">362</span></a>    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="padwin-363"><a href="#padwin-363"><span class="linenos">363</span></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">([</span><span class="n">rng</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span>
</span><span id="padwin-364"><a href="#padwin-364"><span class="linenos">364</span></a>
</span><span id="padwin-365"><a href="#padwin-365"><span class="linenos">365</span></a>    <span class="k">return</span> <span class="n">pad</span><span class="p">,</span> <span class="n">mask</span>
</span></pre></div>


            <div class="docstring"><p>Pad the signal according to the given order and return the mask of indices defining each window on the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>order</strong> (int, optional):
The number of samples to be considered as averaging window.</li>
<li><strong>pad_style</strong> (str, optional):
The type of padding style adopted before filtering.</li>
<li><strong>offset</strong> (float, optional):
Value in [0, 1] defining how the averaging window is obtained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>pad</strong> (np.ndarray):
The padded signal.</li>
<li><strong>mask</strong> (np.ndarray):
A 2D mask where each row denotes the indices of one window on the signal.</li>
</ul>
</div>


                </section>
                <section id="thresholding_filt">
                            <input id="thresholding_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">thresholding_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">robust</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="thresholding_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#thresholding_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="thresholding_filt-368"><a href="#thresholding_filt-368"><span class="linenos">368</span></a><span class="k">def</span><span class="w"> </span><span class="nf">thresholding_filt</span><span class="p">(</span>
</span><span id="thresholding_filt-369"><a href="#thresholding_filt-369"><span class="linenos">369</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="thresholding_filt-370"><a href="#thresholding_filt-370"><span class="linenos">370</span></a>    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="thresholding_filt-371"><a href="#thresholding_filt-371"><span class="linenos">371</span></a>    <span class="n">robust</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="thresholding_filt-372"><a href="#thresholding_filt-372"><span class="linenos">372</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="thresholding_filt-373"><a href="#thresholding_filt-373"><span class="linenos">373</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="thresholding_filt-374"><a href="#thresholding_filt-374"><span class="linenos">374</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="thresholding_filt-375"><a href="#thresholding_filt-375"><span class="linenos">375</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="thresholding_filt-376"><a href="#thresholding_filt-376"><span class="linenos">376</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="thresholding_filt-377"><a href="#thresholding_filt-377"><span class="linenos">377</span></a><span class="sd">    Apply a thresholding filter where only those values being moving average filter to the signal.</span>
</span><span id="thresholding_filt-378"><a href="#thresholding_filt-378"><span class="linenos">378</span></a>
</span><span id="thresholding_filt-379"><a href="#thresholding_filt-379"><span class="linenos">379</span></a><span class="sd">    Parameters</span>
</span><span id="thresholding_filt-380"><a href="#thresholding_filt-380"><span class="linenos">380</span></a><span class="sd">    ----------</span>
</span><span id="thresholding_filt-381"><a href="#thresholding_filt-381"><span class="linenos">381</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="thresholding_filt-382"><a href="#thresholding_filt-382"><span class="linenos">382</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="thresholding_filt-383"><a href="#thresholding_filt-383"><span class="linenos">383</span></a><span class="sd">    factor : float or int, optional</span>
</span><span id="thresholding_filt-384"><a href="#thresholding_filt-384"><span class="linenos">384</span></a><span class="sd">        The factor multiplied by the standard deviation of the window to detect extremes.</span>
</span><span id="thresholding_filt-385"><a href="#thresholding_filt-385"><span class="linenos">385</span></a><span class="sd">    robust : bool, optional</span>
</span><span id="thresholding_filt-386"><a href="#thresholding_filt-386"><span class="linenos">386</span></a><span class="sd">        If True, use median and MAD; otherwise, use mean and std.</span>
</span><span id="thresholding_filt-387"><a href="#thresholding_filt-387"><span class="linenos">387</span></a><span class="sd">    order : int, optional</span>
</span><span id="thresholding_filt-388"><a href="#thresholding_filt-388"><span class="linenos">388</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="thresholding_filt-389"><a href="#thresholding_filt-389"><span class="linenos">389</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="thresholding_filt-390"><a href="#thresholding_filt-390"><span class="linenos">390</span></a><span class="sd">        The type of padding style.</span>
</span><span id="thresholding_filt-391"><a href="#thresholding_filt-391"><span class="linenos">391</span></a><span class="sd">    offset : float, optional</span>
</span><span id="thresholding_filt-392"><a href="#thresholding_filt-392"><span class="linenos">392</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="thresholding_filt-393"><a href="#thresholding_filt-393"><span class="linenos">393</span></a>
</span><span id="thresholding_filt-394"><a href="#thresholding_filt-394"><span class="linenos">394</span></a><span class="sd">    Returns</span>
</span><span id="thresholding_filt-395"><a href="#thresholding_filt-395"><span class="linenos">395</span></a><span class="sd">    -------</span>
</span><span id="thresholding_filt-396"><a href="#thresholding_filt-396"><span class="linenos">396</span></a><span class="sd">    np.ndarray</span>
</span><span id="thresholding_filt-397"><a href="#thresholding_filt-397"><span class="linenos">397</span></a><span class="sd">        The filtered signal.</span>
</span><span id="thresholding_filt-398"><a href="#thresholding_filt-398"><span class="linenos">398</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="thresholding_filt-399"><a href="#thresholding_filt-399"><span class="linenos">399</span></a>
</span><span id="thresholding_filt-400"><a href="#thresholding_filt-400"><span class="linenos">400</span></a>    <span class="c1"># pad the array</span>
</span><span id="thresholding_filt-401"><a href="#thresholding_filt-401"><span class="linenos">401</span></a>    <span class="n">pads</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">padwin</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">pad_style</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="thresholding_filt-402"><a href="#thresholding_filt-402"><span class="linenos">402</span></a>
</span><span id="thresholding_filt-403"><a href="#thresholding_filt-403"><span class="linenos">403</span></a>    <span class="c1"># get the required values</span>
</span><span id="thresholding_filt-404"><a href="#thresholding_filt-404"><span class="linenos">404</span></a>    <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
</span><span id="thresholding_filt-405"><a href="#thresholding_filt-405"><span class="linenos">405</span></a>        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="thresholding_filt-406"><a href="#thresholding_filt-406"><span class="linenos">406</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span>
</span><span id="thresholding_filt-407"><a href="#thresholding_filt-407"><span class="linenos">407</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
</span><span id="thresholding_filt-408"><a href="#thresholding_filt-408"><span class="linenos">408</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="thresholding_filt-409"><a href="#thresholding_filt-409"><span class="linenos">409</span></a>        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="thresholding_filt-410"><a href="#thresholding_filt-410"><span class="linenos">410</span></a>        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">pads</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span><span id="thresholding_filt-411"><a href="#thresholding_filt-411"><span class="linenos">411</span></a>
</span><span id="thresholding_filt-412"><a href="#thresholding_filt-412"><span class="linenos">412</span></a>    <span class="c1"># replace the extreme values</span>
</span><span id="thresholding_filt-413"><a href="#thresholding_filt-413"><span class="linenos">413</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="thresholding_filt-414"><a href="#thresholding_filt-414"><span class="linenos">414</span></a>    <span class="n">extremes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">thresh</span>
</span><span id="thresholding_filt-415"><a href="#thresholding_filt-415"><span class="linenos">415</span></a>    <span class="n">out</span><span class="p">[</span><span class="n">extremes</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">extremes</span><span class="p">]</span>
</span><span id="thresholding_filt-416"><a href="#thresholding_filt-416"><span class="linenos">416</span></a>
</span><span id="thresholding_filt-417"><a href="#thresholding_filt-417"><span class="linenos">417</span></a>    <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Apply a thresholding filter where only those values being moving average filter to the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>factor</strong> (float or int, optional):
The factor multiplied by the standard deviation of the window to detect extremes.</li>
<li><strong>robust</strong> (bool, optional):
If True, use median and MAD; otherwise, use mean and std.</li>
<li><strong>order</strong> (int, optional):
The number of samples for the averaging window.</li>
<li><strong>pad_style</strong> (str, optional):
The type of padding style.</li>
<li><strong>offset</strong> (float, optional):
Value in [0, 1] defining how the averaging window is obtained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="mean_filt">
                            <input id="mean_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="mean_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mean_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mean_filt-420"><a href="#mean_filt-420"><span class="linenos">420</span></a><span class="k">def</span><span class="w"> </span><span class="nf">mean_filt</span><span class="p">(</span>
</span><span id="mean_filt-421"><a href="#mean_filt-421"><span class="linenos">421</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="mean_filt-422"><a href="#mean_filt-422"><span class="linenos">422</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="mean_filt-423"><a href="#mean_filt-423"><span class="linenos">423</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="mean_filt-424"><a href="#mean_filt-424"><span class="linenos">424</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="mean_filt-425"><a href="#mean_filt-425"><span class="linenos">425</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="mean_filt-426"><a href="#mean_filt-426"><span class="linenos">426</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mean_filt-427"><a href="#mean_filt-427"><span class="linenos">427</span></a><span class="sd">    Apply a moving average filter to the signal.</span>
</span><span id="mean_filt-428"><a href="#mean_filt-428"><span class="linenos">428</span></a>
</span><span id="mean_filt-429"><a href="#mean_filt-429"><span class="linenos">429</span></a><span class="sd">    Parameters</span>
</span><span id="mean_filt-430"><a href="#mean_filt-430"><span class="linenos">430</span></a><span class="sd">    ----------</span>
</span><span id="mean_filt-431"><a href="#mean_filt-431"><span class="linenos">431</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="mean_filt-432"><a href="#mean_filt-432"><span class="linenos">432</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="mean_filt-433"><a href="#mean_filt-433"><span class="linenos">433</span></a><span class="sd">    order : int, optional</span>
</span><span id="mean_filt-434"><a href="#mean_filt-434"><span class="linenos">434</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="mean_filt-435"><a href="#mean_filt-435"><span class="linenos">435</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="mean_filt-436"><a href="#mean_filt-436"><span class="linenos">436</span></a><span class="sd">        The type of padding style.</span>
</span><span id="mean_filt-437"><a href="#mean_filt-437"><span class="linenos">437</span></a><span class="sd">    offset : float, optional</span>
</span><span id="mean_filt-438"><a href="#mean_filt-438"><span class="linenos">438</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="mean_filt-439"><a href="#mean_filt-439"><span class="linenos">439</span></a>
</span><span id="mean_filt-440"><a href="#mean_filt-440"><span class="linenos">440</span></a><span class="sd">    Returns</span>
</span><span id="mean_filt-441"><a href="#mean_filt-441"><span class="linenos">441</span></a><span class="sd">    -------</span>
</span><span id="mean_filt-442"><a href="#mean_filt-442"><span class="linenos">442</span></a><span class="sd">    np.ndarray</span>
</span><span id="mean_filt-443"><a href="#mean_filt-443"><span class="linenos">443</span></a><span class="sd">        The filtered signal.</span>
</span><span id="mean_filt-444"><a href="#mean_filt-444"><span class="linenos">444</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="mean_filt-445"><a href="#mean_filt-445"><span class="linenos">445</span></a>
</span><span id="mean_filt-446"><a href="#mean_filt-446"><span class="linenos">446</span></a>    <span class="c1"># get the window range</span>
</span><span id="mean_filt-447"><a href="#mean_filt-447"><span class="linenos">447</span></a>
</span><span id="mean_filt-448"><a href="#mean_filt-448"><span class="linenos">448</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span>
</span><span id="mean_filt-449"><a href="#mean_filt-449"><span class="linenos">449</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">init</span>
</span><span id="mean_filt-450"><a href="#mean_filt-450"><span class="linenos">450</span></a>
</span><span id="mean_filt-451"><a href="#mean_filt-451"><span class="linenos">451</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="mean_filt-452"><a href="#mean_filt-452"><span class="linenos">452</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="mean_filt-453"><a href="#mean_filt-453"><span class="linenos">453</span></a>
</span><span id="mean_filt-454"><a href="#mean_filt-454"><span class="linenos">454</span></a>    <span class="c1"># padding</span>
</span><span id="mean_filt-455"><a href="#mean_filt-455"><span class="linenos">455</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="mean_filt-456"><a href="#mean_filt-456"><span class="linenos">456</span></a>
</span><span id="mean_filt-457"><a href="#mean_filt-457"><span class="linenos">457</span></a>    <span class="c1"># get the cumulative sum of the signal</span>
</span><span id="mean_filt-458"><a href="#mean_filt-458"><span class="linenos">458</span></a>    <span class="n">csum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pad</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="mean_filt-459"><a href="#mean_filt-459"><span class="linenos">459</span></a>
</span><span id="mean_filt-460"><a href="#mean_filt-460"><span class="linenos">460</span></a>    <span class="c1"># get the mean</span>
</span><span id="mean_filt-461"><a href="#mean_filt-461"><span class="linenos">461</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">stop</span><span class="p">]</span> <span class="o">-</span> <span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">init</span><span class="p">])</span> <span class="o">/</span> <span class="n">order</span>
</span></pre></div>


            <div class="docstring"><p>Apply a moving average filter to the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>order</strong> (int, optional):
The number of samples for the averaging window.</li>
<li><strong>pad_style</strong> (str, optional):
The type of padding style.</li>
<li><strong>offset</strong> (float, optional):
Value in [0, 1] defining how the averaging window is obtained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="median_filt">
                            <input id="median_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="median_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#median_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="median_filt-464"><a href="#median_filt-464"><span class="linenos">464</span></a><span class="k">def</span><span class="w"> </span><span class="nf">median_filt</span><span class="p">(</span>
</span><span id="median_filt-465"><a href="#median_filt-465"><span class="linenos">465</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="median_filt-466"><a href="#median_filt-466"><span class="linenos">466</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="median_filt-467"><a href="#median_filt-467"><span class="linenos">467</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="median_filt-468"><a href="#median_filt-468"><span class="linenos">468</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="median_filt-469"><a href="#median_filt-469"><span class="linenos">469</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="median_filt-470"><a href="#median_filt-470"><span class="linenos">470</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="median_filt-471"><a href="#median_filt-471"><span class="linenos">471</span></a><span class="sd">    Apply a median filter to the signal.</span>
</span><span id="median_filt-472"><a href="#median_filt-472"><span class="linenos">472</span></a>
</span><span id="median_filt-473"><a href="#median_filt-473"><span class="linenos">473</span></a><span class="sd">    Parameters</span>
</span><span id="median_filt-474"><a href="#median_filt-474"><span class="linenos">474</span></a><span class="sd">    ----------</span>
</span><span id="median_filt-475"><a href="#median_filt-475"><span class="linenos">475</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="median_filt-476"><a href="#median_filt-476"><span class="linenos">476</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="median_filt-477"><a href="#median_filt-477"><span class="linenos">477</span></a><span class="sd">    order : int, optional</span>
</span><span id="median_filt-478"><a href="#median_filt-478"><span class="linenos">478</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="median_filt-479"><a href="#median_filt-479"><span class="linenos">479</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="median_filt-480"><a href="#median_filt-480"><span class="linenos">480</span></a><span class="sd">        The type of padding style.</span>
</span><span id="median_filt-481"><a href="#median_filt-481"><span class="linenos">481</span></a><span class="sd">    offset : float, optional</span>
</span><span id="median_filt-482"><a href="#median_filt-482"><span class="linenos">482</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="median_filt-483"><a href="#median_filt-483"><span class="linenos">483</span></a>
</span><span id="median_filt-484"><a href="#median_filt-484"><span class="linenos">484</span></a><span class="sd">    Returns</span>
</span><span id="median_filt-485"><a href="#median_filt-485"><span class="linenos">485</span></a><span class="sd">    -------</span>
</span><span id="median_filt-486"><a href="#median_filt-486"><span class="linenos">486</span></a><span class="sd">    np.ndarray</span>
</span><span id="median_filt-487"><a href="#median_filt-487"><span class="linenos">487</span></a><span class="sd">        The filtered signal.</span>
</span><span id="median_filt-488"><a href="#median_filt-488"><span class="linenos">488</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="median_filt-489"><a href="#median_filt-489"><span class="linenos">489</span></a>    <span class="n">pad</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">padwin</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">pad_style</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span><span id="median_filt-490"><a href="#median_filt-490"><span class="linenos">490</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Apply a median filter to the signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>order</strong> (int, optional):
The number of samples for the averaging window.</li>
<li><strong>pad_style</strong> (str, optional):
The type of padding style.</li>
<li><strong>offset</strong> (float, optional):
Value in [0, 1] defining how the averaging window is obtained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="rms_filt">
                            <input id="rms_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rms_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;edge&#39;</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="rms_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rms_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rms_filt-493"><a href="#rms_filt-493"><span class="linenos">493</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rms_filt</span><span class="p">(</span>
</span><span id="rms_filt-494"><a href="#rms_filt-494"><span class="linenos">494</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="rms_filt-495"><a href="#rms_filt-495"><span class="linenos">495</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="rms_filt-496"><a href="#rms_filt-496"><span class="linenos">496</span></a>    <span class="n">pad_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span><span class="p">,</span>
</span><span id="rms_filt-497"><a href="#rms_filt-497"><span class="linenos">497</span></a>    <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="rms_filt-498"><a href="#rms_filt-498"><span class="linenos">498</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="rms_filt-499"><a href="#rms_filt-499"><span class="linenos">499</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="rms_filt-500"><a href="#rms_filt-500"><span class="linenos">500</span></a><span class="sd">    Obtain the root-mean-square of the signal with the given sampling window.</span>
</span><span id="rms_filt-501"><a href="#rms_filt-501"><span class="linenos">501</span></a>
</span><span id="rms_filt-502"><a href="#rms_filt-502"><span class="linenos">502</span></a><span class="sd">    Parameters</span>
</span><span id="rms_filt-503"><a href="#rms_filt-503"><span class="linenos">503</span></a><span class="sd">    ----------</span>
</span><span id="rms_filt-504"><a href="#rms_filt-504"><span class="linenos">504</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="rms_filt-505"><a href="#rms_filt-505"><span class="linenos">505</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="rms_filt-506"><a href="#rms_filt-506"><span class="linenos">506</span></a><span class="sd">    order : int, optional</span>
</span><span id="rms_filt-507"><a href="#rms_filt-507"><span class="linenos">507</span></a><span class="sd">        The number of samples for the averaging window.</span>
</span><span id="rms_filt-508"><a href="#rms_filt-508"><span class="linenos">508</span></a><span class="sd">    pad_style : str, optional</span>
</span><span id="rms_filt-509"><a href="#rms_filt-509"><span class="linenos">509</span></a><span class="sd">        The type of padding style.</span>
</span><span id="rms_filt-510"><a href="#rms_filt-510"><span class="linenos">510</span></a><span class="sd">    offset : float, optional</span>
</span><span id="rms_filt-511"><a href="#rms_filt-511"><span class="linenos">511</span></a><span class="sd">        Value in [0, 1] defining how the averaging window is obtained.</span>
</span><span id="rms_filt-512"><a href="#rms_filt-512"><span class="linenos">512</span></a>
</span><span id="rms_filt-513"><a href="#rms_filt-513"><span class="linenos">513</span></a><span class="sd">    Returns</span>
</span><span id="rms_filt-514"><a href="#rms_filt-514"><span class="linenos">514</span></a><span class="sd">    -------</span>
</span><span id="rms_filt-515"><a href="#rms_filt-515"><span class="linenos">515</span></a><span class="sd">    np.ndarray</span>
</span><span id="rms_filt-516"><a href="#rms_filt-516"><span class="linenos">516</span></a><span class="sd">        The filtered signal.</span>
</span><span id="rms_filt-517"><a href="#rms_filt-517"><span class="linenos">517</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="rms_filt-518"><a href="#rms_filt-518"><span class="linenos">518</span></a>
</span><span id="rms_filt-519"><a href="#rms_filt-519"><span class="linenos">519</span></a>    <span class="c1"># get the window range</span>
</span><span id="rms_filt-520"><a href="#rms_filt-520"><span class="linenos">520</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">order</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span>
</span><span id="rms_filt-521"><a href="#rms_filt-521"><span class="linenos">521</span></a>    <span class="n">init</span> <span class="o">=</span> <span class="n">order</span> <span class="o">-</span> <span class="n">stop</span>
</span><span id="rms_filt-522"><a href="#rms_filt-522"><span class="linenos">522</span></a>
</span><span id="rms_filt-523"><a href="#rms_filt-523"><span class="linenos">523</span></a>    <span class="c1"># get the indices of the samples</span>
</span><span id="rms_filt-524"><a href="#rms_filt-524"><span class="linenos">524</span></a>    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">+</span> <span class="n">init</span>
</span><span id="rms_filt-525"><a href="#rms_filt-525"><span class="linenos">525</span></a>
</span><span id="rms_filt-526"><a href="#rms_filt-526"><span class="linenos">526</span></a>    <span class="c1"># padding</span>
</span><span id="rms_filt-527"><a href="#rms_filt-527"><span class="linenos">527</span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="n">init</span><span class="p">,</span> <span class="n">stop</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">pad_style</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="rms_filt-528"><a href="#rms_filt-528"><span class="linenos">528</span></a>
</span><span id="rms_filt-529"><a href="#rms_filt-529"><span class="linenos">529</span></a>    <span class="c1"># get the squares of the signal</span>
</span><span id="rms_filt-530"><a href="#rms_filt-530"><span class="linenos">530</span></a>    <span class="n">sqe</span> <span class="o">=</span> <span class="n">pad</span><span class="o">**</span><span class="mi">2</span>
</span><span id="rms_filt-531"><a href="#rms_filt-531"><span class="linenos">531</span></a>
</span><span id="rms_filt-532"><a href="#rms_filt-532"><span class="linenos">532</span></a>    <span class="c1"># get the cumulative sum of the signal</span>
</span><span id="rms_filt-533"><a href="#rms_filt-533"><span class="linenos">533</span></a>    <span class="n">csum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">sqe</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="rms_filt-534"><a href="#rms_filt-534"><span class="linenos">534</span></a>
</span><span id="rms_filt-535"><a href="#rms_filt-535"><span class="linenos">535</span></a>    <span class="c1"># get the root mean of the squares</span>
</span><span id="rms_filt-536"><a href="#rms_filt-536"><span class="linenos">536</span></a>    <span class="k">return</span> <span class="p">((</span><span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="n">stop</span><span class="p">]</span> <span class="o">-</span> <span class="n">csum</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="n">init</span><span class="p">])</span> <span class="o">/</span> <span class="n">order</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span></pre></div>


            <div class="docstring"><p>Obtain the root-mean-square of the signal with the given sampling window.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>order</strong> (int, optional):
The number of samples for the averaging window.</li>
<li><strong>pad_style</strong> (str, optional):
The type of padding style.</li>
<li><strong>offset</strong> (float, optional):
Value in [0, 1] defining how the averaging window is obtained.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="butterworth_filt">
                            <input id="butterworth_filt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">butterworth_filt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;lowpass&#39;</span><span class="p">,</span> <span class="s1">&#39;highpass&#39;</span><span class="p">,</span> <span class="s1">&#39;bandpass&#39;</span><span class="p">,</span> <span class="s1">&#39;bandstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lowpass&#39;</span>,</span><span class="param">	<span class="n">phase_corrected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="butterworth_filt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#butterworth_filt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="butterworth_filt-620"><a href="#butterworth_filt-620"><span class="linenos">620</span></a><span class="k">def</span><span class="w"> </span><span class="nf">butterworth_filt</span><span class="p">(</span>
</span><span id="butterworth_filt-621"><a href="#butterworth_filt-621"><span class="linenos">621</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="butterworth_filt-622"><a href="#butterworth_filt-622"><span class="linenos">622</span></a>    <span class="n">fcut</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="butterworth_filt-623"><a href="#butterworth_filt-623"><span class="linenos">623</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="butterworth_filt-624"><a href="#butterworth_filt-624"><span class="linenos">624</span></a>    <span class="n">order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="butterworth_filt-625"><a href="#butterworth_filt-625"><span class="linenos">625</span></a>    <span class="n">ftype</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;lowpass&quot;</span><span class="p">,</span> <span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="s2">&quot;bandstop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lowpass&quot;</span><span class="p">,</span>
</span><span id="butterworth_filt-626"><a href="#butterworth_filt-626"><span class="linenos">626</span></a>    <span class="n">phase_corrected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="butterworth_filt-627"><a href="#butterworth_filt-627"><span class="linenos">627</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="butterworth_filt-628"><a href="#butterworth_filt-628"><span class="linenos">628</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="butterworth_filt-629"><a href="#butterworth_filt-629"><span class="linenos">629</span></a><span class="sd">    Apply a Butterworth filter with the specified parameters.</span>
</span><span id="butterworth_filt-630"><a href="#butterworth_filt-630"><span class="linenos">630</span></a>
</span><span id="butterworth_filt-631"><a href="#butterworth_filt-631"><span class="linenos">631</span></a><span class="sd">    Parameters</span>
</span><span id="butterworth_filt-632"><a href="#butterworth_filt-632"><span class="linenos">632</span></a><span class="sd">    ----------</span>
</span><span id="butterworth_filt-633"><a href="#butterworth_filt-633"><span class="linenos">633</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="butterworth_filt-634"><a href="#butterworth_filt-634"><span class="linenos">634</span></a><span class="sd">        The signal to be filtered.</span>
</span><span id="butterworth_filt-635"><a href="#butterworth_filt-635"><span class="linenos">635</span></a><span class="sd">    fcut : float, int, list, or tuple, optional</span>
</span><span id="butterworth_filt-636"><a href="#butterworth_filt-636"><span class="linenos">636</span></a><span class="sd">        The cutoff frequency of the filter.</span>
</span><span id="butterworth_filt-637"><a href="#butterworth_filt-637"><span class="linenos">637</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="butterworth_filt-638"><a href="#butterworth_filt-638"><span class="linenos">638</span></a><span class="sd">        The sampling frequency of the signal.</span>
</span><span id="butterworth_filt-639"><a href="#butterworth_filt-639"><span class="linenos">639</span></a><span class="sd">    order : int, optional</span>
</span><span id="butterworth_filt-640"><a href="#butterworth_filt-640"><span class="linenos">640</span></a><span class="sd">        The order of the filter.</span>
</span><span id="butterworth_filt-641"><a href="#butterworth_filt-641"><span class="linenos">641</span></a><span class="sd">    ftype : str, optional</span>
</span><span id="butterworth_filt-642"><a href="#butterworth_filt-642"><span class="linenos">642</span></a><span class="sd">        The type of filter: &quot;bandpass&quot;, &quot;lowpass&quot;, &quot;highpass&quot;, &quot;bandstop&quot;.</span>
</span><span id="butterworth_filt-643"><a href="#butterworth_filt-643"><span class="linenos">643</span></a><span class="sd">    phase_corrected : bool, optional</span>
</span><span id="butterworth_filt-644"><a href="#butterworth_filt-644"><span class="linenos">644</span></a><span class="sd">        If True, apply the filter twice in opposite directions to correct for phase lag.</span>
</span><span id="butterworth_filt-645"><a href="#butterworth_filt-645"><span class="linenos">645</span></a>
</span><span id="butterworth_filt-646"><a href="#butterworth_filt-646"><span class="linenos">646</span></a><span class="sd">    Returns</span>
</span><span id="butterworth_filt-647"><a href="#butterworth_filt-647"><span class="linenos">647</span></a><span class="sd">    -------</span>
</span><span id="butterworth_filt-648"><a href="#butterworth_filt-648"><span class="linenos">648</span></a><span class="sd">    np.ndarray</span>
</span><span id="butterworth_filt-649"><a href="#butterworth_filt-649"><span class="linenos">649</span></a><span class="sd">        The filtered signal.</span>
</span><span id="butterworth_filt-650"><a href="#butterworth_filt-650"><span class="linenos">650</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="butterworth_filt-651"><a href="#butterworth_filt-651"><span class="linenos">651</span></a>
</span><span id="butterworth_filt-652"><a href="#butterworth_filt-652"><span class="linenos">652</span></a>    <span class="c1"># get the filter coefficients</span>
</span><span id="butterworth_filt-653"><a href="#butterworth_filt-653"><span class="linenos">653</span></a>    <span class="n">sos</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span>
</span><span id="butterworth_filt-654"><a href="#butterworth_filt-654"><span class="linenos">654</span></a>        <span class="n">order</span><span class="p">,</span>
</span><span id="butterworth_filt-655"><a href="#butterworth_filt-655"><span class="linenos">655</span></a>        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fcut</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">fsamp</span><span class="p">)),</span>
</span><span id="butterworth_filt-656"><a href="#butterworth_filt-656"><span class="linenos">656</span></a>        <span class="n">ftype</span><span class="p">,</span>
</span><span id="butterworth_filt-657"><a href="#butterworth_filt-657"><span class="linenos">657</span></a>        <span class="n">analog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="butterworth_filt-658"><a href="#butterworth_filt-658"><span class="linenos">658</span></a>        <span class="n">output</span><span class="o">=</span><span class="s2">&quot;sos&quot;</span><span class="p">,</span>
</span><span id="butterworth_filt-659"><a href="#butterworth_filt-659"><span class="linenos">659</span></a>    <span class="p">)</span>
</span><span id="butterworth_filt-660"><a href="#butterworth_filt-660"><span class="linenos">660</span></a>
</span><span id="butterworth_filt-661"><a href="#butterworth_filt-661"><span class="linenos">661</span></a>    <span class="c1"># get the filtered data</span>
</span><span id="butterworth_filt-662"><a href="#butterworth_filt-662"><span class="linenos">662</span></a>    <span class="k">if</span> <span class="n">phase_corrected</span><span class="p">:</span>
</span><span id="butterworth_filt-663"><a href="#butterworth_filt-663"><span class="linenos">663</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfiltfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</span><span id="butterworth_filt-664"><a href="#butterworth_filt-664"><span class="linenos">664</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="butterworth_filt-665"><a href="#butterworth_filt-665"><span class="linenos">665</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">sosfilt</span><span class="p">(</span><span class="n">sos</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="butterworth_filt-666"><a href="#butterworth_filt-666"><span class="linenos">666</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arr</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Apply a Butterworth filter with the specified parameters.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be filtered.</li>
<li><strong>fcut</strong> (float, int, list, or tuple, optional):
The cutoff frequency of the filter.</li>
<li><strong>fsamp</strong> (float or int, optional):
The sampling frequency of the signal.</li>
<li><strong>order</strong> (int, optional):
The order of the filter.</li>
<li><strong>ftype</strong> (str, optional):
The type of filter: "bandpass", "lowpass", "highpass", "bandstop".</li>
<li><strong>phase_corrected</strong> (bool, optional):
If True, apply the filter twice in opposite directions to correct for phase lag.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The filtered signal.</li>
</ul>
</div>


                </section>
                <section id="cubicspline_interp">
                            <input id="cubicspline_interp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cubicspline_interp</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">y_old</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">nsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">x_old</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">x_new</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="cubicspline_interp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cubicspline_interp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cubicspline_interp-669"><a href="#cubicspline_interp-669"><span class="linenos">669</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cubicspline_interp</span><span class="p">(</span>
</span><span id="cubicspline_interp-670"><a href="#cubicspline_interp-670"><span class="linenos">670</span></a>    <span class="n">y_old</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="cubicspline_interp-671"><a href="#cubicspline_interp-671"><span class="linenos">671</span></a>    <span class="n">nsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="cubicspline_interp-672"><a href="#cubicspline_interp-672"><span class="linenos">672</span></a>    <span class="n">x_old</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="cubicspline_interp-673"><a href="#cubicspline_interp-673"><span class="linenos">673</span></a>    <span class="n">x_new</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="cubicspline_interp-674"><a href="#cubicspline_interp-674"><span class="linenos">674</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="cubicspline_interp-675"><a href="#cubicspline_interp-675"><span class="linenos">675</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="cubicspline_interp-676"><a href="#cubicspline_interp-676"><span class="linenos">676</span></a><span class="sd">    Get the cubic spline interpolation of y.</span>
</span><span id="cubicspline_interp-677"><a href="#cubicspline_interp-677"><span class="linenos">677</span></a>
</span><span id="cubicspline_interp-678"><a href="#cubicspline_interp-678"><span class="linenos">678</span></a><span class="sd">    Parameters</span>
</span><span id="cubicspline_interp-679"><a href="#cubicspline_interp-679"><span class="linenos">679</span></a><span class="sd">    ----------</span>
</span><span id="cubicspline_interp-680"><a href="#cubicspline_interp-680"><span class="linenos">680</span></a><span class="sd">    y_old : np.ndarray</span>
</span><span id="cubicspline_interp-681"><a href="#cubicspline_interp-681"><span class="linenos">681</span></a><span class="sd">        The data to be interpolated.</span>
</span><span id="cubicspline_interp-682"><a href="#cubicspline_interp-682"><span class="linenos">682</span></a><span class="sd">    nsamp : int or None, optional</span>
</span><span id="cubicspline_interp-683"><a href="#cubicspline_interp-683"><span class="linenos">683</span></a><span class="sd">        The number of points for the interpolation.</span>
</span><span id="cubicspline_interp-684"><a href="#cubicspline_interp-684"><span class="linenos">684</span></a><span class="sd">    x_old : np.ndarray or None, optional</span>
</span><span id="cubicspline_interp-685"><a href="#cubicspline_interp-685"><span class="linenos">685</span></a><span class="sd">        The x coordinates corresponding to y. Ignored if nsamp is provided.</span>
</span><span id="cubicspline_interp-686"><a href="#cubicspline_interp-686"><span class="linenos">686</span></a><span class="sd">    x_new : np.ndarray or None, optional</span>
</span><span id="cubicspline_interp-687"><a href="#cubicspline_interp-687"><span class="linenos">687</span></a><span class="sd">        The new x coordinates for interpolation. Ignored if nsamp is provided.</span>
</span><span id="cubicspline_interp-688"><a href="#cubicspline_interp-688"><span class="linenos">688</span></a>
</span><span id="cubicspline_interp-689"><a href="#cubicspline_interp-689"><span class="linenos">689</span></a><span class="sd">    Returns</span>
</span><span id="cubicspline_interp-690"><a href="#cubicspline_interp-690"><span class="linenos">690</span></a><span class="sd">    -------</span>
</span><span id="cubicspline_interp-691"><a href="#cubicspline_interp-691"><span class="linenos">691</span></a><span class="sd">    np.ndarray</span>
</span><span id="cubicspline_interp-692"><a href="#cubicspline_interp-692"><span class="linenos">692</span></a><span class="sd">        The interpolated y axis.</span>
</span><span id="cubicspline_interp-693"><a href="#cubicspline_interp-693"><span class="linenos">693</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="cubicspline_interp-694"><a href="#cubicspline_interp-694"><span class="linenos">694</span></a>
</span><span id="cubicspline_interp-695"><a href="#cubicspline_interp-695"><span class="linenos">695</span></a>    <span class="c1"># control of the inputs</span>
</span><span id="cubicspline_interp-696"><a href="#cubicspline_interp-696"><span class="linenos">696</span></a>    <span class="k">if</span> <span class="n">nsamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cubicspline_interp-697"><a href="#cubicspline_interp-697"><span class="linenos">697</span></a>        <span class="k">if</span> <span class="n">x_old</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cubicspline_interp-698"><a href="#cubicspline_interp-698"><span class="linenos">698</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;the pair x_old / x_new or nsamp must be defined&quot;</span><span class="p">)</span>
</span><span id="cubicspline_interp-699"><a href="#cubicspline_interp-699"><span class="linenos">699</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="cubicspline_interp-700"><a href="#cubicspline_interp-700"><span class="linenos">700</span></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_old</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="cubicspline_interp-701"><a href="#cubicspline_interp-701"><span class="linenos">701</span></a>        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_old</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_old</span><span class="p">),</span> <span class="n">nsamp</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="cubicspline_interp-702"><a href="#cubicspline_interp-702"><span class="linenos">702</span></a>
</span><span id="cubicspline_interp-703"><a href="#cubicspline_interp-703"><span class="linenos">703</span></a>    <span class="c1"># get the cubic-spline interpolated y</span>
</span><span id="cubicspline_interp-704"><a href="#cubicspline_interp-704"><span class="linenos">704</span></a>    <span class="n">cspline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x_old</span><span class="p">,</span> <span class="n">y_old</span><span class="p">)</span>
</span><span id="cubicspline_interp-705"><a href="#cubicspline_interp-705"><span class="linenos">705</span></a>    <span class="k">return</span> <span class="n">cspline</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the cubic spline interpolation of y.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>y_old</strong> (np.ndarray):
The data to be interpolated.</li>
<li><strong>nsamp</strong> (int or None, optional):
The number of points for the interpolation.</li>
<li><strong>x_old</strong> (np.ndarray or None, optional):
The x coordinates corresponding to y. Ignored if nsamp is provided.</li>
<li><strong>x_new</strong> (np.ndarray or None, optional):
The new x coordinates for interpolation. Ignored if nsamp is provided.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The interpolated y axis.</li>
</ul>
</div>


                </section>
                <section id="residual_analysis">
                            <input id="residual_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">residual_analysis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">ffun</span><span class="p">:</span> <span class="n">function</span> <span class="o">|</span> <span class="n">method</span>,</span><span class="param">	<span class="n">fnum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">nseg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">minsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="residual_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#residual_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="residual_analysis-708"><a href="#residual_analysis-708"><span class="linenos">708</span></a><span class="k">def</span><span class="w"> </span><span class="nf">residual_analysis</span><span class="p">(</span>
</span><span id="residual_analysis-709"><a href="#residual_analysis-709"><span class="linenos">709</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="residual_analysis-710"><a href="#residual_analysis-710"><span class="linenos">710</span></a>    <span class="n">ffun</span><span class="p">:</span> <span class="n">FunctionType</span> <span class="o">|</span> <span class="n">MethodType</span><span class="p">,</span>
</span><span id="residual_analysis-711"><a href="#residual_analysis-711"><span class="linenos">711</span></a>    <span class="n">fnum</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="residual_analysis-712"><a href="#residual_analysis-712"><span class="linenos">712</span></a>    <span class="n">fmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="residual_analysis-713"><a href="#residual_analysis-713"><span class="linenos">713</span></a>    <span class="n">nseg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="residual_analysis-714"><a href="#residual_analysis-714"><span class="linenos">714</span></a>    <span class="n">minsamp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="residual_analysis-715"><a href="#residual_analysis-715"><span class="linenos">715</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="residual_analysis-716"><a href="#residual_analysis-716"><span class="linenos">716</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="residual_analysis-717"><a href="#residual_analysis-717"><span class="linenos">717</span></a><span class="sd">    Perform Winter&#39;s residual analysis of the input signal.</span>
</span><span id="residual_analysis-718"><a href="#residual_analysis-718"><span class="linenos">718</span></a>
</span><span id="residual_analysis-719"><a href="#residual_analysis-719"><span class="linenos">719</span></a><span class="sd">    Parameters</span>
</span><span id="residual_analysis-720"><a href="#residual_analysis-720"><span class="linenos">720</span></a><span class="sd">    ----------</span>
</span><span id="residual_analysis-721"><a href="#residual_analysis-721"><span class="linenos">721</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="residual_analysis-722"><a href="#residual_analysis-722"><span class="linenos">722</span></a><span class="sd">        The signal to be investigated.</span>
</span><span id="residual_analysis-723"><a href="#residual_analysis-723"><span class="linenos">723</span></a><span class="sd">    ffun : FunctionType or MethodType</span>
</span><span id="residual_analysis-724"><a href="#residual_analysis-724"><span class="linenos">724</span></a><span class="sd">        The filter to be used for the analysis.</span>
</span><span id="residual_analysis-725"><a href="#residual_analysis-725"><span class="linenos">725</span></a><span class="sd">    fnum : int, optional</span>
</span><span id="residual_analysis-726"><a href="#residual_analysis-726"><span class="linenos">726</span></a><span class="sd">        The number of frequencies to be tested.</span>
</span><span id="residual_analysis-727"><a href="#residual_analysis-727"><span class="linenos">727</span></a><span class="sd">    fmax : float or int or None, optional</span>
</span><span id="residual_analysis-728"><a href="#residual_analysis-728"><span class="linenos">728</span></a><span class="sd">        The maximum frequency to be tested.</span>
</span><span id="residual_analysis-729"><a href="#residual_analysis-729"><span class="linenos">729</span></a><span class="sd">    nseg : int, optional</span>
</span><span id="residual_analysis-730"><a href="#residual_analysis-730"><span class="linenos">730</span></a><span class="sd">        The number of segments for fitting.</span>
</span><span id="residual_analysis-731"><a href="#residual_analysis-731"><span class="linenos">731</span></a><span class="sd">    minsamp : int, optional</span>
</span><span id="residual_analysis-732"><a href="#residual_analysis-732"><span class="linenos">732</span></a><span class="sd">        The minimum number of elements per segment.</span>
</span><span id="residual_analysis-733"><a href="#residual_analysis-733"><span class="linenos">733</span></a>
</span><span id="residual_analysis-734"><a href="#residual_analysis-734"><span class="linenos">734</span></a><span class="sd">    Returns</span>
</span><span id="residual_analysis-735"><a href="#residual_analysis-735"><span class="linenos">735</span></a><span class="sd">    -------</span>
</span><span id="residual_analysis-736"><a href="#residual_analysis-736"><span class="linenos">736</span></a><span class="sd">    float</span>
</span><span id="residual_analysis-737"><a href="#residual_analysis-737"><span class="linenos">737</span></a><span class="sd">        The suggested cutoff value.</span>
</span><span id="residual_analysis-738"><a href="#residual_analysis-738"><span class="linenos">738</span></a><span class="sd">    np.ndarray</span>
</span><span id="residual_analysis-739"><a href="#residual_analysis-739"><span class="linenos">739</span></a><span class="sd">        The tested frequencies.</span>
</span><span id="residual_analysis-740"><a href="#residual_analysis-740"><span class="linenos">740</span></a><span class="sd">    np.ndarray</span>
</span><span id="residual_analysis-741"><a href="#residual_analysis-741"><span class="linenos">741</span></a><span class="sd">        The residuals corresponding to the given frequency.</span>
</span><span id="residual_analysis-742"><a href="#residual_analysis-742"><span class="linenos">742</span></a>
</span><span id="residual_analysis-743"><a href="#residual_analysis-743"><span class="linenos">743</span></a><span class="sd">    Notes</span>
</span><span id="residual_analysis-744"><a href="#residual_analysis-744"><span class="linenos">744</span></a><span class="sd">    -----</span>
</span><span id="residual_analysis-745"><a href="#residual_analysis-745"><span class="linenos">745</span></a><span class="sd">    The signal is filtered over a range of frequencies and the sum of squared residuals (SSE) against the original signal is computed for each tested cut-off frequency. Next, a series of fitting lines are used to estimate the optimal disruption point defining the cut-off frequency optimally discriminating between noise and good quality signal.</span>
</span><span id="residual_analysis-746"><a href="#residual_analysis-746"><span class="linenos">746</span></a>
</span><span id="residual_analysis-747"><a href="#residual_analysis-747"><span class="linenos">747</span></a><span class="sd">    References</span>
</span><span id="residual_analysis-748"><a href="#residual_analysis-748"><span class="linenos">748</span></a><span class="sd">    ----------</span>
</span><span id="residual_analysis-749"><a href="#residual_analysis-749"><span class="linenos">749</span></a><span class="sd">    Winter DA 2009, Biomechanics and Motor Control of Human Movement. Fourth Ed. John Wiley &amp; Sons Inc, Hoboken, New Jersey (US).</span>
</span><span id="residual_analysis-750"><a href="#residual_analysis-750"><span class="linenos">750</span></a>
</span><span id="residual_analysis-751"><a href="#residual_analysis-751"><span class="linenos">751</span></a><span class="sd">    Lerman PM 1980, Fitting Segmented Regression Models by Grid Search.</span>
</span><span id="residual_analysis-752"><a href="#residual_analysis-752"><span class="linenos">752</span></a><span class="sd">        Appl Stat. 29(1):77.</span>
</span><span id="residual_analysis-753"><a href="#residual_analysis-753"><span class="linenos">753</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="residual_analysis-754"><a href="#residual_analysis-754"><span class="linenos">754</span></a>
</span><span id="residual_analysis-755"><a href="#residual_analysis-755"><span class="linenos">755</span></a>    <span class="c1"># data check</span>
</span><span id="residual_analysis-756"><a href="#residual_analysis-756"><span class="linenos">756</span></a>    <span class="k">if</span> <span class="n">fmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="residual_analysis-757"><a href="#residual_analysis-757"><span class="linenos">757</span></a>        <span class="n">pwr</span><span class="p">,</span> <span class="n">frq</span> <span class="o">=</span> <span class="n">psd</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="residual_analysis-758"><a href="#residual_analysis-758"><span class="linenos">758</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pwr</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pwr</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.99</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
</span><span id="residual_analysis-759"><a href="#residual_analysis-759"><span class="linenos">759</span></a>        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">frq</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
</span><span id="residual_analysis-760"><a href="#residual_analysis-760"><span class="linenos">760</span></a>    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">fmax</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;fmax must lie in the (0, 0.5) range.&quot;</span>
</span><span id="residual_analysis-761"><a href="#residual_analysis-761"><span class="linenos">761</span></a>    <span class="k">assert</span> <span class="n">minsamp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;&#39;min_samples&#39; must be &gt;= 2.&quot;</span>
</span><span id="residual_analysis-762"><a href="#residual_analysis-762"><span class="linenos">762</span></a>
</span><span id="residual_analysis-763"><a href="#residual_analysis-763"><span class="linenos">763</span></a>    <span class="c1"># get the optimal crossing over point</span>
</span><span id="residual_analysis-764"><a href="#residual_analysis-764"><span class="linenos">764</span></a>    <span class="n">frq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">fnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="residual_analysis-765"><a href="#residual_analysis-765"><span class="linenos">765</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">arr</span> <span class="o">-</span> <span class="n">ffun</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">frq</span><span class="p">])</span>
</span><span id="residual_analysis-766"><a href="#residual_analysis-766"><span class="linenos">766</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="residual_analysis-767"><a href="#residual_analysis-767"><span class="linenos">767</span></a>    <span class="n">iopt</span> <span class="o">=</span> <span class="n">crossovers</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">nseg</span><span class="p">,</span> <span class="n">minsamp</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="residual_analysis-768"><a href="#residual_analysis-768"><span class="linenos">768</span></a>    <span class="n">fopt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frq</span><span class="p">[</span><span class="n">iopt</span><span class="p">])</span>
</span><span id="residual_analysis-769"><a href="#residual_analysis-769"><span class="linenos">769</span></a>
</span><span id="residual_analysis-770"><a href="#residual_analysis-770"><span class="linenos">770</span></a>    <span class="c1"># return the parameters</span>
</span><span id="residual_analysis-771"><a href="#residual_analysis-771"><span class="linenos">771</span></a>    <span class="k">return</span> <span class="n">fopt</span><span class="p">,</span> <span class="n">frq</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform Winter's residual analysis of the input signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be investigated.</li>
<li><strong>ffun</strong> (FunctionType or MethodType):
The filter to be used for the analysis.</li>
<li><strong>fnum</strong> (int, optional):
The number of frequencies to be tested.</li>
<li><strong>fmax</strong> (float or int or None, optional):
The maximum frequency to be tested.</li>
<li><strong>nseg</strong> (int, optional):
The number of segments for fitting.</li>
<li><strong>minsamp</strong> (int, optional):
The minimum number of elements per segment.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: The suggested cutoff value.</li>
<li><strong>np.ndarray</strong>: The tested frequencies.</li>
<li><strong>np.ndarray</strong>: The residuals corresponding to the given frequency.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The signal is filtered over a range of frequencies and the sum of squared residuals (SSE) against the original signal is computed for each tested cut-off frequency. Next, a series of fitting lines are used to estimate the optimal disruption point defining the cut-off frequency optimally discriminating between noise and good quality signal.</p>

<h6 id="references">References</h6>

<p>Winter DA 2009, Biomechanics and Motor Control of Human Movement. Fourth Ed. John Wiley &amp; Sons Inc, Hoboken, New Jersey (US).</p>

<p>Lerman PM 1980, Fitting Segmented Regression Models by Grid Search.
    Appl Stat. 29(1):77.</p>
</div>


                </section>
                <section id="crossovers">
                            <input id="crossovers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crossovers</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="crossovers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#crossovers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="crossovers-811"><a href="#crossovers-811"><span class="linenos">811</span></a><span class="k">def</span><span class="w"> </span><span class="nf">crossovers</span><span class="p">(</span>
</span><span id="crossovers-812"><a href="#crossovers-812"><span class="linenos">812</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="crossovers-813"><a href="#crossovers-813"><span class="linenos">813</span></a>    <span class="n">segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="crossovers-814"><a href="#crossovers-814"><span class="linenos">814</span></a>    <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="crossovers-815"><a href="#crossovers-815"><span class="linenos">815</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="crossovers-816"><a href="#crossovers-816"><span class="linenos">816</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="crossovers-817"><a href="#crossovers-817"><span class="linenos">817</span></a><span class="sd">    Detect the position of the crossing over points between K regression lines used to best fit the data.</span>
</span><span id="crossovers-818"><a href="#crossovers-818"><span class="linenos">818</span></a>
</span><span id="crossovers-819"><a href="#crossovers-819"><span class="linenos">819</span></a><span class="sd">    Parameters</span>
</span><span id="crossovers-820"><a href="#crossovers-820"><span class="linenos">820</span></a><span class="sd">    ----------</span>
</span><span id="crossovers-821"><a href="#crossovers-821"><span class="linenos">821</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="crossovers-822"><a href="#crossovers-822"><span class="linenos">822</span></a><span class="sd">        The signal to be fitted.</span>
</span><span id="crossovers-823"><a href="#crossovers-823"><span class="linenos">823</span></a><span class="sd">    segments : int, optional</span>
</span><span id="crossovers-824"><a href="#crossovers-824"><span class="linenos">824</span></a><span class="sd">        The number of segments for fitting.</span>
</span><span id="crossovers-825"><a href="#crossovers-825"><span class="linenos">825</span></a><span class="sd">    min_samples : int, optional</span>
</span><span id="crossovers-826"><a href="#crossovers-826"><span class="linenos">826</span></a><span class="sd">        The minimum number of elements per segment.</span>
</span><span id="crossovers-827"><a href="#crossovers-827"><span class="linenos">827</span></a>
</span><span id="crossovers-828"><a href="#crossovers-828"><span class="linenos">828</span></a><span class="sd">    Returns</span>
</span><span id="crossovers-829"><a href="#crossovers-829"><span class="linenos">829</span></a><span class="sd">    -------</span>
</span><span id="crossovers-830"><a href="#crossovers-830"><span class="linenos">830</span></a><span class="sd">    np.ndarray</span>
</span><span id="crossovers-831"><a href="#crossovers-831"><span class="linenos">831</span></a><span class="sd">        Indices of the detected crossing over points.</span>
</span><span id="crossovers-832"><a href="#crossovers-832"><span class="linenos">832</span></a><span class="sd">    np.ndarray</span>
</span><span id="crossovers-833"><a href="#crossovers-833"><span class="linenos">833</span></a><span class="sd">        Slopes and intercepts of the fitting segments.</span>
</span><span id="crossovers-834"><a href="#crossovers-834"><span class="linenos">834</span></a>
</span><span id="crossovers-835"><a href="#crossovers-835"><span class="linenos">835</span></a><span class="sd">    Notes</span>
</span><span id="crossovers-836"><a href="#crossovers-836"><span class="linenos">836</span></a><span class="sd">    -----</span>
</span><span id="crossovers-837"><a href="#crossovers-837"><span class="linenos">837</span></a><span class="sd">    Steps:</span>
</span><span id="crossovers-838"><a href="#crossovers-838"><span class="linenos">838</span></a><span class="sd">        1) Get all segment combinations.</span>
</span><span id="crossovers-839"><a href="#crossovers-839"><span class="linenos">839</span></a><span class="sd">        2) For each, calculate regression lines.</span>
</span><span id="crossovers-840"><a href="#crossovers-840"><span class="linenos">840</span></a><span class="sd">        3) For each, calculate residuals.</span>
</span><span id="crossovers-841"><a href="#crossovers-841"><span class="linenos">841</span></a><span class="sd">        4) Sort by residuals.</span>
</span><span id="crossovers-842"><a href="#crossovers-842"><span class="linenos">842</span></a><span class="sd">        5) Return best combination.</span>
</span><span id="crossovers-843"><a href="#crossovers-843"><span class="linenos">843</span></a>
</span><span id="crossovers-844"><a href="#crossovers-844"><span class="linenos">844</span></a><span class="sd">    References</span>
</span><span id="crossovers-845"><a href="#crossovers-845"><span class="linenos">845</span></a><span class="sd">    ----------</span>
</span><span id="crossovers-846"><a href="#crossovers-846"><span class="linenos">846</span></a><span class="sd">    Lerman PM 1980, Fitting Segmented Regression Models by Grid Search. Appl Stat. 29(1):77.</span>
</span><span id="crossovers-847"><a href="#crossovers-847"><span class="linenos">847</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="crossovers-848"><a href="#crossovers-848"><span class="linenos">848</span></a>
</span><span id="crossovers-849"><a href="#crossovers-849"><span class="linenos">849</span></a>    <span class="c1"># control the inputs</span>
</span><span id="crossovers-850"><a href="#crossovers-850"><span class="linenos">850</span></a>    <span class="k">assert</span> <span class="n">min_samples</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;&#39;min_samples&#39; must be &gt;= 2.&quot;</span>
</span><span id="crossovers-851"><a href="#crossovers-851"><span class="linenos">851</span></a>
</span><span id="crossovers-852"><a href="#crossovers-852"><span class="linenos">852</span></a>    <span class="c1"># get the X axis</span>
</span><span id="crossovers-853"><a href="#crossovers-853"><span class="linenos">853</span></a>    <span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="crossovers-854"><a href="#crossovers-854"><span class="linenos">854</span></a>
</span><span id="crossovers-855"><a href="#crossovers-855"><span class="linenos">855</span></a>    <span class="c1"># get all the possible combinations of segments</span>
</span><span id="crossovers-856"><a href="#crossovers-856"><span class="linenos">856</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="crossovers-857"><a href="#crossovers-857"><span class="linenos">857</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">segments</span><span class="p">):</span>
</span><span id="crossovers-858"><a href="#crossovers-858"><span class="linenos">858</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">min_samples</span> <span class="o">*</span> <span class="n">i</span>
</span><span id="crossovers-859"><a href="#crossovers-859"><span class="linenos">859</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_samples</span> <span class="o">*</span> <span class="p">(</span><span class="n">segments</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
</span><span id="crossovers-860"><a href="#crossovers-860"><span class="linenos">860</span></a>        <span class="n">combs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)]</span>
</span><span id="crossovers-861"><a href="#crossovers-861"><span class="linenos">861</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">combs</span><span class="p">))</span>
</span><span id="crossovers-862"><a href="#crossovers-862"><span class="linenos">862</span></a>
</span><span id="crossovers-863"><a href="#crossovers-863"><span class="linenos">863</span></a>    <span class="c1"># remove those combinations having segments shorter than &quot;samples&quot;</span>
</span><span id="crossovers-864"><a href="#crossovers-864"><span class="linenos">864</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combs</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_samples</span><span class="p">)]</span>
</span><span id="crossovers-865"><a href="#crossovers-865"><span class="linenos">865</span></a>
</span><span id="crossovers-866"><a href="#crossovers-866"><span class="linenos">866</span></a>    <span class="c1"># generate the crossovers matrix</span>
</span><span id="crossovers-867"><a href="#crossovers-867"><span class="linenos">867</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="crossovers-868"><a href="#crossovers-868"><span class="linenos">868</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="crossovers-869"><a href="#crossovers-869"><span class="linenos">869</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span>
</span><span id="crossovers-870"><a href="#crossovers-870"><span class="linenos">870</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">combs</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="crossovers-871"><a href="#crossovers-871"><span class="linenos">871</span></a>    <span class="p">)</span>
</span><span id="crossovers-872"><a href="#crossovers-872"><span class="linenos">872</span></a>    <span class="n">combs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">combs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="crossovers-873"><a href="#crossovers-873"><span class="linenos">873</span></a>
</span><span id="crossovers-874"><a href="#crossovers-874"><span class="linenos">874</span></a>    <span class="c1"># calculate the residuals for each combination</span>
</span><span id="crossovers-875"><a href="#crossovers-875"><span class="linenos">875</span></a>    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_sse</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">])</span>
</span><span id="crossovers-876"><a href="#crossovers-876"><span class="linenos">876</span></a>
</span><span id="crossovers-877"><a href="#crossovers-877"><span class="linenos">877</span></a>    <span class="c1"># sort the residuals</span>
</span><span id="crossovers-878"><a href="#crossovers-878"><span class="linenos">878</span></a>    <span class="n">sortedsse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sse</span><span class="p">)</span>
</span><span id="crossovers-879"><a href="#crossovers-879"><span class="linenos">879</span></a>
</span><span id="crossovers-880"><a href="#crossovers-880"><span class="linenos">880</span></a>    <span class="c1"># get the optimal crossovers order</span>
</span><span id="crossovers-881"><a href="#crossovers-881"><span class="linenos">881</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">xaxis</span><span class="p">[</span><span class="n">combs</span><span class="p">[</span><span class="n">sortedsse</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
</span><span id="crossovers-882"><a href="#crossovers-882"><span class="linenos">882</span></a>
</span><span id="crossovers-883"><a href="#crossovers-883"><span class="linenos">883</span></a>    <span class="c1"># get the fitting slopes</span>
</span><span id="crossovers-884"><a href="#crossovers-884"><span class="linenos">884</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i0</span><span class="p">,</span> <span class="n">i1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i0</span><span class="p">,</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">crs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">crs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="crossovers-885"><a href="#crossovers-885"><span class="linenos">885</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="crossovers-886"><a href="#crossovers-886"><span class="linenos">886</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">slopes</span>
</span><span id="crossovers-887"><a href="#crossovers-887"><span class="linenos">887</span></a>    <span class="p">]</span>
</span><span id="crossovers-888"><a href="#crossovers-888"><span class="linenos">888</span></a>    <span class="n">slopes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slopes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="crossovers-889"><a href="#crossovers-889"><span class="linenos">889</span></a>
</span><span id="crossovers-890"><a href="#crossovers-890"><span class="linenos">890</span></a>    <span class="c1"># return the crossovers</span>
</span><span id="crossovers-891"><a href="#crossovers-891"><span class="linenos">891</span></a>    <span class="k">return</span> <span class="n">crs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">slopes</span>
</span></pre></div>


            <div class="docstring"><p>Detect the position of the crossing over points between K regression lines used to best fit the data.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The signal to be fitted.</li>
<li><strong>segments</strong> (int, optional):
The number of segments for fitting.</li>
<li><strong>min_samples</strong> (int, optional):
The minimum number of elements per segment.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: Indices of the detected crossing over points.</li>
<li><strong>np.ndarray</strong>: Slopes and intercepts of the fitting segments.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Steps:
    1) Get all segment combinations.
    2) For each, calculate regression lines.
    3) For each, calculate residuals.
    4) Sort by residuals.
    5) Return best combination.</p>

<h6 id="references">References</h6>

<p>Lerman PM 1980, Fitting Segmented Regression Models by Grid Search. Appl Stat. 29(1):77.</p>
</div>


                </section>
                <section id="psd">
                            <input id="psd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">psd</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="psd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#psd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="psd-894"><a href="#psd-894"><span class="linenos">894</span></a><span class="k">def</span><span class="w"> </span><span class="nf">psd</span><span class="p">(</span>
</span><span id="psd-895"><a href="#psd-895"><span class="linenos">895</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="psd-896"><a href="#psd-896"><span class="linenos">896</span></a>    <span class="n">fsamp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="psd-897"><a href="#psd-897"><span class="linenos">897</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="psd-898"><a href="#psd-898"><span class="linenos">898</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="psd-899"><a href="#psd-899"><span class="linenos">899</span></a><span class="sd">    Compute the power spectrum of signal using FFT.</span>
</span><span id="psd-900"><a href="#psd-900"><span class="linenos">900</span></a>
</span><span id="psd-901"><a href="#psd-901"><span class="linenos">901</span></a><span class="sd">    Parameters</span>
</span><span id="psd-902"><a href="#psd-902"><span class="linenos">902</span></a><span class="sd">    ----------</span>
</span><span id="psd-903"><a href="#psd-903"><span class="linenos">903</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="psd-904"><a href="#psd-904"><span class="linenos">904</span></a><span class="sd">        A 1D numpy array.</span>
</span><span id="psd-905"><a href="#psd-905"><span class="linenos">905</span></a><span class="sd">    fsamp : float or int, optional</span>
</span><span id="psd-906"><a href="#psd-906"><span class="linenos">906</span></a><span class="sd">        The sampling frequency (Hz) of the signal.</span>
</span><span id="psd-907"><a href="#psd-907"><span class="linenos">907</span></a>
</span><span id="psd-908"><a href="#psd-908"><span class="linenos">908</span></a><span class="sd">    Returns</span>
</span><span id="psd-909"><a href="#psd-909"><span class="linenos">909</span></a><span class="sd">    -------</span>
</span><span id="psd-910"><a href="#psd-910"><span class="linenos">910</span></a><span class="sd">    np.ndarray</span>
</span><span id="psd-911"><a href="#psd-911"><span class="linenos">911</span></a><span class="sd">        The frequency corresponding to each element of power.</span>
</span><span id="psd-912"><a href="#psd-912"><span class="linenos">912</span></a><span class="sd">    np.ndarray</span>
</span><span id="psd-913"><a href="#psd-913"><span class="linenos">913</span></a><span class="sd">        The power of each frequency.</span>
</span><span id="psd-914"><a href="#psd-914"><span class="linenos">914</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="psd-915"><a href="#psd-915"><span class="linenos">915</span></a>
</span><span id="psd-916"><a href="#psd-916"><span class="linenos">916</span></a>    <span class="c1"># get the psd</span>
</span><span id="psd-917"><a href="#psd-917"><span class="linenos">917</span></a>    <span class="n">fft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="psd-918"><a href="#psd-918"><span class="linenos">918</span></a>    <span class="n">amp</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">)</span>
</span><span id="psd-919"><a href="#psd-919"><span class="linenos">919</span></a>    <span class="n">pwr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">amp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">amp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">amp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="psd-920"><a href="#psd-920"><span class="linenos">920</span></a>    <span class="n">frq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fsamp</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwr</span><span class="p">))</span>
</span><span id="psd-921"><a href="#psd-921"><span class="linenos">921</span></a>
</span><span id="psd-922"><a href="#psd-922"><span class="linenos">922</span></a>    <span class="c1"># return the data</span>
</span><span id="psd-923"><a href="#psd-923"><span class="linenos">923</span></a>    <span class="k">return</span> <span class="n">frq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">pwr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the power spectrum of signal using FFT.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
A 1D numpy array.</li>
<li><strong>fsamp</strong> (float or int, optional):
The sampling frequency (Hz) of the signal.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The frequency corresponding to each element of power.</li>
<li><strong>np.ndarray</strong>: The power of each frequency.</li>
</ul>
</div>


                </section>
                <section id="crossings">
                            <input id="crossings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crossings</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="crossings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#crossings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="crossings-926"><a href="#crossings-926"><span class="linenos">926</span></a><span class="k">def</span><span class="w"> </span><span class="nf">crossings</span><span class="p">(</span>
</span><span id="crossings-927"><a href="#crossings-927"><span class="linenos">927</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="crossings-928"><a href="#crossings-928"><span class="linenos">928</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="crossings-929"><a href="#crossings-929"><span class="linenos">929</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="crossings-930"><a href="#crossings-930"><span class="linenos">930</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="crossings-931"><a href="#crossings-931"><span class="linenos">931</span></a><span class="sd">    Detect the crossing points in arr compared to value.</span>
</span><span id="crossings-932"><a href="#crossings-932"><span class="linenos">932</span></a>
</span><span id="crossings-933"><a href="#crossings-933"><span class="linenos">933</span></a><span class="sd">    Parameters</span>
</span><span id="crossings-934"><a href="#crossings-934"><span class="linenos">934</span></a><span class="sd">    ----------</span>
</span><span id="crossings-935"><a href="#crossings-935"><span class="linenos">935</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="crossings-936"><a href="#crossings-936"><span class="linenos">936</span></a><span class="sd">        The 1D signal from which the crossings have to be found.</span>
</span><span id="crossings-937"><a href="#crossings-937"><span class="linenos">937</span></a><span class="sd">    value : int or float, optional</span>
</span><span id="crossings-938"><a href="#crossings-938"><span class="linenos">938</span></a><span class="sd">        The crossing value.</span>
</span><span id="crossings-939"><a href="#crossings-939"><span class="linenos">939</span></a>
</span><span id="crossings-940"><a href="#crossings-940"><span class="linenos">940</span></a><span class="sd">    Returns</span>
</span><span id="crossings-941"><a href="#crossings-941"><span class="linenos">941</span></a><span class="sd">    -------</span>
</span><span id="crossings-942"><a href="#crossings-942"><span class="linenos">942</span></a><span class="sd">    np.ndarray</span>
</span><span id="crossings-943"><a href="#crossings-943"><span class="linenos">943</span></a><span class="sd">        The samples corresponding to the crossings.</span>
</span><span id="crossings-944"><a href="#crossings-944"><span class="linenos">944</span></a><span class="sd">    np.ndarray</span>
</span><span id="crossings-945"><a href="#crossings-945"><span class="linenos">945</span></a><span class="sd">        The sign of the crossings.</span>
</span><span id="crossings-946"><a href="#crossings-946"><span class="linenos">946</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="crossings-947"><a href="#crossings-947"><span class="linenos">947</span></a>
</span><span id="crossings-948"><a href="#crossings-948"><span class="linenos">948</span></a>    <span class="c1"># get the sign of the signal without the offset</span>
</span><span id="crossings-949"><a href="#crossings-949"><span class="linenos">949</span></a>    <span class="n">sgn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">value</span><span class="p">)</span>
</span><span id="crossings-950"><a href="#crossings-950"><span class="linenos">950</span></a>
</span><span id="crossings-951"><a href="#crossings-951"><span class="linenos">951</span></a>    <span class="c1"># get the location of the crossings</span>
</span><span id="crossings-952"><a href="#crossings-952"><span class="linenos">952</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sgn</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">sgn</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="crossings-953"><a href="#crossings-953"><span class="linenos">953</span></a>
</span><span id="crossings-954"><a href="#crossings-954"><span class="linenos">954</span></a>    <span class="c1"># return the crossings</span>
</span><span id="crossings-955"><a href="#crossings-955"><span class="linenos">955</span></a>    <span class="k">return</span> <span class="n">crs</span><span class="p">,</span> <span class="o">-</span><span class="n">sgn</span><span class="p">[</span><span class="n">crs</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Detect the crossing points in arr compared to value.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The 1D signal from which the crossings have to be found.</li>
<li><strong>value</strong> (int or float, optional):
The crossing value.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The samples corresponding to the crossings.</li>
<li><strong>np.ndarray</strong>: The sign of the crossings.</li>
</ul>
</div>


                </section>
                <section id="xcorr">
                            <input id="xcorr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">xcorr</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sig1</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">sig2</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">biased</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="xcorr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#xcorr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="xcorr-958"><a href="#xcorr-958"><span class="linenos"> 958</span></a><span class="k">def</span><span class="w"> </span><span class="nf">xcorr</span><span class="p">(</span>
</span><span id="xcorr-959"><a href="#xcorr-959"><span class="linenos"> 959</span></a>    <span class="n">sig1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="xcorr-960"><a href="#xcorr-960"><span class="linenos"> 960</span></a>    <span class="n">sig2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="xcorr-961"><a href="#xcorr-961"><span class="linenos"> 961</span></a>    <span class="n">biased</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="xcorr-962"><a href="#xcorr-962"><span class="linenos"> 962</span></a>    <span class="n">full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="xcorr-963"><a href="#xcorr-963"><span class="linenos"> 963</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="xcorr-964"><a href="#xcorr-964"><span class="linenos"> 964</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="xcorr-965"><a href="#xcorr-965"><span class="linenos"> 965</span></a><span class="sd">    Set the (multiple) auto/cross correlation of the data in y.</span>
</span><span id="xcorr-966"><a href="#xcorr-966"><span class="linenos"> 966</span></a>
</span><span id="xcorr-967"><a href="#xcorr-967"><span class="linenos"> 967</span></a><span class="sd">    Parameters</span>
</span><span id="xcorr-968"><a href="#xcorr-968"><span class="linenos"> 968</span></a><span class="sd">    ----------</span>
</span><span id="xcorr-969"><a href="#xcorr-969"><span class="linenos"> 969</span></a><span class="sd">    sig1 : np.ndarray</span>
</span><span id="xcorr-970"><a href="#xcorr-970"><span class="linenos"> 970</span></a><span class="sd">        The signal for auto/cross-correlation.</span>
</span><span id="xcorr-971"><a href="#xcorr-971"><span class="linenos"> 971</span></a><span class="sd">    sig2 : np.ndarray or None, optional</span>
</span><span id="xcorr-972"><a href="#xcorr-972"><span class="linenos"> 972</span></a><span class="sd">        The second signal for cross-correlation. If None, autocorrelation is computed.</span>
</span><span id="xcorr-973"><a href="#xcorr-973"><span class="linenos"> 973</span></a><span class="sd">    biased : bool, optional</span>
</span><span id="xcorr-974"><a href="#xcorr-974"><span class="linenos"> 974</span></a><span class="sd">        If True, use the biased estimator.</span>
</span><span id="xcorr-975"><a href="#xcorr-975"><span class="linenos"> 975</span></a><span class="sd">    full : bool, optional</span>
</span><span id="xcorr-976"><a href="#xcorr-976"><span class="linenos"> 976</span></a><span class="sd">        If True, report negative lags.</span>
</span><span id="xcorr-977"><a href="#xcorr-977"><span class="linenos"> 977</span></a>
</span><span id="xcorr-978"><a href="#xcorr-978"><span class="linenos"> 978</span></a><span class="sd">    Returns</span>
</span><span id="xcorr-979"><a href="#xcorr-979"><span class="linenos"> 979</span></a><span class="sd">    -------</span>
</span><span id="xcorr-980"><a href="#xcorr-980"><span class="linenos"> 980</span></a><span class="sd">    np.ndarray</span>
</span><span id="xcorr-981"><a href="#xcorr-981"><span class="linenos"> 981</span></a><span class="sd">        The auto/cross-correlation value.</span>
</span><span id="xcorr-982"><a href="#xcorr-982"><span class="linenos"> 982</span></a><span class="sd">    np.ndarray</span>
</span><span id="xcorr-983"><a href="#xcorr-983"><span class="linenos"> 983</span></a><span class="sd">        The lags in sample units.</span>
</span><span id="xcorr-984"><a href="#xcorr-984"><span class="linenos"> 984</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="xcorr-985"><a href="#xcorr-985"><span class="linenos"> 985</span></a>
</span><span id="xcorr-986"><a href="#xcorr-986"><span class="linenos"> 986</span></a>    <span class="c1"># take the autocorrelation if only y is provided</span>
</span><span id="xcorr-987"><a href="#xcorr-987"><span class="linenos"> 987</span></a>    <span class="k">if</span> <span class="n">sig2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="xcorr-988"><a href="#xcorr-988"><span class="linenos"> 988</span></a>        <span class="n">sigx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">sig1</span><span class="p">)</span>
</span><span id="xcorr-989"><a href="#xcorr-989"><span class="linenos"> 989</span></a>        <span class="n">sigz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sigx</span><span class="p">,</span> <span class="n">sigx</span><span class="p">])</span>
</span><span id="xcorr-990"><a href="#xcorr-990"><span class="linenos"> 990</span></a>
</span><span id="xcorr-991"><a href="#xcorr-991"><span class="linenos"> 991</span></a>    <span class="c1"># take the cross-correlation (ensure the shortest signal is zero-padded)</span>
</span><span id="xcorr-992"><a href="#xcorr-992"><span class="linenos"> 992</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="xcorr-993"><a href="#xcorr-993"><span class="linenos"> 993</span></a>        <span class="n">sigx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sig1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig2</span><span class="p">))))</span>
</span><span id="xcorr-994"><a href="#xcorr-994"><span class="linenos"> 994</span></a>        <span class="n">sigy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sigx</span><span class="p">)</span>
</span><span id="xcorr-995"><a href="#xcorr-995"><span class="linenos"> 995</span></a>        <span class="n">sigx</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sig1</span>
</span><span id="xcorr-996"><a href="#xcorr-996"><span class="linenos"> 996</span></a>        <span class="n">sigy</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sig2</span>
</span><span id="xcorr-997"><a href="#xcorr-997"><span class="linenos"> 997</span></a>        <span class="n">sigz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sigx</span><span class="p">,</span> <span class="n">sigy</span><span class="p">])</span>
</span><span id="xcorr-998"><a href="#xcorr-998"><span class="linenos"> 998</span></a>
</span><span id="xcorr-999"><a href="#xcorr-999"><span class="linenos"> 999</span></a>    <span class="c1"># get the matrix shape</span>
</span><span id="xcorr-1000"><a href="#xcorr-1000"><span class="linenos">1000</span></a>    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">sigz</span><span class="o">.</span><span class="n">shape</span>
</span><span id="xcorr-1001"><a href="#xcorr-1001"><span class="linenos">1001</span></a>
</span><span id="xcorr-1002"><a href="#xcorr-1002"><span class="linenos">1002</span></a>    <span class="c1"># remove the mean from each dimension</span>
</span><span id="xcorr-1003"><a href="#xcorr-1003"><span class="linenos">1003</span></a>    <span class="n">sigv</span> <span class="o">=</span> <span class="n">sigz</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sigz</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="xcorr-1004"><a href="#xcorr-1004"><span class="linenos">1004</span></a>
</span><span id="xcorr-1005"><a href="#xcorr-1005"><span class="linenos">1005</span></a>    <span class="c1"># take the cross-correlation</span>
</span><span id="xcorr-1006"><a href="#xcorr-1006"><span class="linenos">1006</span></a>    <span class="n">xcr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="xcorr-1007"><a href="#xcorr-1007"><span class="linenos">1007</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="xcorr-1008"><a href="#xcorr-1008"><span class="linenos">1008</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
</span><span id="xcorr-1009"><a href="#xcorr-1009"><span class="linenos">1009</span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">sigv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigv</span><span class="p">[</span><span class="n">j</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;full&quot;</span><span class="p">)</span>
</span><span id="xcorr-1010"><a href="#xcorr-1010"><span class="linenos">1010</span></a>            <span class="n">xcr</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">res</span><span class="p">)]</span>
</span><span id="xcorr-1011"><a href="#xcorr-1011"><span class="linenos">1011</span></a>
</span><span id="xcorr-1012"><a href="#xcorr-1012"><span class="linenos">1012</span></a>    <span class="c1"># average over all the multiples</span>
</span><span id="xcorr-1013"><a href="#xcorr-1013"><span class="linenos">1013</span></a>    <span class="n">xcr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">xcr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="xcorr-1014"><a href="#xcorr-1014"><span class="linenos">1014</span></a>
</span><span id="xcorr-1015"><a href="#xcorr-1015"><span class="linenos">1015</span></a>    <span class="c1"># adjust the output</span>
</span><span id="xcorr-1016"><a href="#xcorr-1016"><span class="linenos">1016</span></a>    <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">cols</span><span class="p">)</span>
</span><span id="xcorr-1017"><a href="#xcorr-1017"><span class="linenos">1017</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span>
</span><span id="xcorr-1018"><a href="#xcorr-1018"><span class="linenos">1018</span></a>        <span class="n">xcr</span> <span class="o">=</span> <span class="n">xcr</span><span class="p">[(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="xcorr-1019"><a href="#xcorr-1019"><span class="linenos">1019</span></a>        <span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span><span class="p">[(</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="xcorr-1020"><a href="#xcorr-1020"><span class="linenos">1020</span></a>
</span><span id="xcorr-1021"><a href="#xcorr-1021"><span class="linenos">1021</span></a>    <span class="c1"># normalize</span>
</span><span id="xcorr-1022"><a href="#xcorr-1022"><span class="linenos">1022</span></a>    <span class="n">xcr</span> <span class="o">/=</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lags</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">biased</span> <span class="k">else</span> <span class="p">(</span><span class="n">cols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="xcorr-1023"><a href="#xcorr-1023"><span class="linenos">1023</span></a>
</span><span id="xcorr-1024"><a href="#xcorr-1024"><span class="linenos">1024</span></a>    <span class="c1"># return the cross-correlation data</span>
</span><span id="xcorr-1025"><a href="#xcorr-1025"><span class="linenos">1025</span></a>    <span class="k">return</span> <span class="n">xcr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">lags</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the (multiple) auto/cross correlation of the data in y.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>sig1</strong> (np.ndarray):
The signal for auto/cross-correlation.</li>
<li><strong>sig2</strong> (np.ndarray or None, optional):
The second signal for cross-correlation. If None, autocorrelation is computed.</li>
<li><strong>biased</strong> (bool, optional):
If True, use the biased estimator.</li>
<li><strong>full</strong> (bool, optional):
If True, report negative lags.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The auto/cross-correlation value.</li>
<li><strong>np.ndarray</strong>: The lags in sample units.</li>
</ul>
</div>


                </section>
                <section id="outlyingness">
                            <input id="outlyingness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outlyingness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="outlyingness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#outlyingness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="outlyingness-1028"><a href="#outlyingness-1028"><span class="linenos">1028</span></a><span class="k">def</span><span class="w"> </span><span class="nf">outlyingness</span><span class="p">(</span>
</span><span id="outlyingness-1029"><a href="#outlyingness-1029"><span class="linenos">1029</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="outlyingness-1030"><a href="#outlyingness-1030"><span class="linenos">1030</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="outlyingness-1031"><a href="#outlyingness-1031"><span class="linenos">1031</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="outlyingness-1032"><a href="#outlyingness-1032"><span class="linenos">1032</span></a><span class="sd">    Return the adjusted outlyingness factor.</span>
</span><span id="outlyingness-1033"><a href="#outlyingness-1033"><span class="linenos">1033</span></a>
</span><span id="outlyingness-1034"><a href="#outlyingness-1034"><span class="linenos">1034</span></a><span class="sd">    Parameters</span>
</span><span id="outlyingness-1035"><a href="#outlyingness-1035"><span class="linenos">1035</span></a><span class="sd">    ----------</span>
</span><span id="outlyingness-1036"><a href="#outlyingness-1036"><span class="linenos">1036</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="outlyingness-1037"><a href="#outlyingness-1037"><span class="linenos">1037</span></a><span class="sd">        The input array.</span>
</span><span id="outlyingness-1038"><a href="#outlyingness-1038"><span class="linenos">1038</span></a>
</span><span id="outlyingness-1039"><a href="#outlyingness-1039"><span class="linenos">1039</span></a><span class="sd">    Returns</span>
</span><span id="outlyingness-1040"><a href="#outlyingness-1040"><span class="linenos">1040</span></a><span class="sd">    -------</span>
</span><span id="outlyingness-1041"><a href="#outlyingness-1041"><span class="linenos">1041</span></a><span class="sd">    np.ndarray</span>
</span><span id="outlyingness-1042"><a href="#outlyingness-1042"><span class="linenos">1042</span></a><span class="sd">        The outlyingness score of each element.</span>
</span><span id="outlyingness-1043"><a href="#outlyingness-1043"><span class="linenos">1043</span></a>
</span><span id="outlyingness-1044"><a href="#outlyingness-1044"><span class="linenos">1044</span></a><span class="sd">    References</span>
</span><span id="outlyingness-1045"><a href="#outlyingness-1045"><span class="linenos">1045</span></a><span class="sd">    ----------</span>
</span><span id="outlyingness-1046"><a href="#outlyingness-1046"><span class="linenos">1046</span></a><span class="sd">    Hubert, M., &amp; Van der Veeken, S. (2008). Outlier detection for skewed data. Journal of Chemometrics: A Journal of the Chemometrics Society, 22(34), 235-246.</span>
</span><span id="outlyingness-1047"><a href="#outlyingness-1047"><span class="linenos">1047</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="outlyingness-1048"><a href="#outlyingness-1048"><span class="linenos">1048</span></a>    <span class="n">qr1</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">qr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
</span><span id="outlyingness-1049"><a href="#outlyingness-1049"><span class="linenos">1049</span></a>    <span class="n">iqr</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">-</span> <span class="n">qr1</span>
</span><span id="outlyingness-1050"><a href="#outlyingness-1050"><span class="linenos">1050</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="n">med</span><span class="p">]</span>
</span><span id="outlyingness-1051"><a href="#outlyingness-1051"><span class="linenos">1051</span></a>    <span class="n">upp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="n">med</span><span class="p">]</span>
</span><span id="outlyingness-1052"><a href="#outlyingness-1052"><span class="linenos">1052</span></a>    <span class="n">mcs</span> <span class="o">=</span> <span class="p">[((</span><span class="n">j</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">i</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">upp</span><span class="p">)]</span>
</span><span id="outlyingness-1053"><a href="#outlyingness-1053"><span class="linenos">1053</span></a>    <span class="n">mcs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">mcs</span><span class="p">)</span>
</span><span id="outlyingness-1054"><a href="#outlyingness-1054"><span class="linenos">1054</span></a>    <span class="k">if</span> <span class="n">mcs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="outlyingness-1055"><a href="#outlyingness-1055"><span class="linenos">1055</span></a>        <span class="n">wt1</span> <span class="o">=</span> <span class="n">qr1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="outlyingness-1056"><a href="#outlyingness-1056"><span class="linenos">1056</span></a>        <span class="n">wt2</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="outlyingness-1057"><a href="#outlyingness-1057"><span class="linenos">1057</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="outlyingness-1058"><a href="#outlyingness-1058"><span class="linenos">1058</span></a>        <span class="n">wt1</span> <span class="o">=</span> <span class="n">qr1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="outlyingness-1059"><a href="#outlyingness-1059"><span class="linenos">1059</span></a>        <span class="n">wt2</span> <span class="o">=</span> <span class="n">qr3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">mcs</span><span class="p">)</span> <span class="o">*</span> <span class="n">iqr</span>
</span><span id="outlyingness-1060"><a href="#outlyingness-1060"><span class="linenos">1060</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="outlyingness-1061"><a href="#outlyingness-1061"><span class="linenos">1061</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
</span><span id="outlyingness-1062"><a href="#outlyingness-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">med</span><span class="p">:</span>
</span><span id="outlyingness-1063"><a href="#outlyingness-1063"><span class="linenos">1063</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="outlyingness-1064"><a href="#outlyingness-1064"><span class="linenos">1064</span></a>        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">med</span><span class="p">:</span>
</span><span id="outlyingness-1065"><a href="#outlyingness-1065"><span class="linenos">1065</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">-</span> <span class="n">med</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">wt2</span> <span class="o">-</span> <span class="n">med</span><span class="p">)]</span>
</span><span id="outlyingness-1066"><a href="#outlyingness-1066"><span class="linenos">1066</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="outlyingness-1067"><a href="#outlyingness-1067"><span class="linenos">1067</span></a>            <span class="n">out</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">med</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">med</span> <span class="o">-</span> <span class="n">wt1</span><span class="p">)]</span>
</span><span id="outlyingness-1068"><a href="#outlyingness-1068"><span class="linenos">1068</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the adjusted outlyingness factor.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
The input array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The outlyingness score of each element.</li>
</ul>

<h6 id="references">References</h6>

<p>Hubert, M., &amp; Van der Veeken, S. (2008). Outlier detection for skewed data. Journal of Chemometrics: A Journal of the Chemometrics Society, 22(34), 235-246.</p>
</div>


                </section>
                <section id="gram_schmidt">
                            <input id="gram_schmidt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gram_schmidt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>, </span><span class="param"><span class="n">j</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>, </span><span class="param"><span class="n">k</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="gram_schmidt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gram_schmidt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gram_schmidt-1071"><a href="#gram_schmidt-1071"><span class="linenos">1071</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gram_schmidt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="gram_schmidt-1072"><a href="#gram_schmidt-1072"><span class="linenos">1072</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="gram_schmidt-1073"><a href="#gram_schmidt-1073"><span class="linenos">1073</span></a><span class="sd">    applies Gram-Schmidt process to obtain ortonormal bases starting from</span>
</span><span id="gram_schmidt-1074"><a href="#gram_schmidt-1074"><span class="linenos">1074</span></a><span class="sd">    3 vectors (i, j, k)</span>
</span><span id="gram_schmidt-1075"><a href="#gram_schmidt-1075"><span class="linenos">1075</span></a>
</span><span id="gram_schmidt-1076"><a href="#gram_schmidt-1076"><span class="linenos">1076</span></a><span class="sd">    Parameters</span>
</span><span id="gram_schmidt-1077"><a href="#gram_schmidt-1077"><span class="linenos">1077</span></a><span class="sd">    ----------</span>
</span><span id="gram_schmidt-1078"><a href="#gram_schmidt-1078"><span class="linenos">1078</span></a><span class="sd">    - i, j, k: array (N, 3)</span>
</span><span id="gram_schmidt-1079"><a href="#gram_schmidt-1079"><span class="linenos">1079</span></a>
</span><span id="gram_schmidt-1080"><a href="#gram_schmidt-1080"><span class="linenos">1080</span></a><span class="sd">    Returns</span>
</span><span id="gram_schmidt-1081"><a href="#gram_schmidt-1081"><span class="linenos">1081</span></a><span class="sd">    -------</span>
</span><span id="gram_schmidt-1082"><a href="#gram_schmidt-1082"><span class="linenos">1082</span></a><span class="sd">    - R: array (N, 3, 3)</span>
</span><span id="gram_schmidt-1083"><a href="#gram_schmidt-1083"><span class="linenos">1083</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="gram_schmidt-1084"><a href="#gram_schmidt-1084"><span class="linenos">1084</span></a>    <span class="c1"># Primo vettore normalizzato</span>
</span><span id="gram_schmidt-1085"><a href="#gram_schmidt-1085"><span class="linenos">1085</span></a>    <span class="n">e1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="gram_schmidt-1086"><a href="#gram_schmidt-1086"><span class="linenos">1086</span></a>
</span><span id="gram_schmidt-1087"><a href="#gram_schmidt-1087"><span class="linenos">1087</span></a>    <span class="c1"># Proiezione di j su e1 e ortogonalizzazione</span>
</span><span id="gram_schmidt-1088"><a href="#gram_schmidt-1088"><span class="linenos">1088</span></a>    <span class="n">proj_j_on_e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">e1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1</span>
</span><span id="gram_schmidt-1089"><a href="#gram_schmidt-1089"><span class="linenos">1089</span></a>    <span class="n">u2</span> <span class="o">=</span> <span class="n">j</span> <span class="o">-</span> <span class="n">proj_j_on_e1</span>
</span><span id="gram_schmidt-1090"><a href="#gram_schmidt-1090"><span class="linenos">1090</span></a>    <span class="n">e2</span> <span class="o">=</span> <span class="n">u2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="gram_schmidt-1091"><a href="#gram_schmidt-1091"><span class="linenos">1091</span></a>
</span><span id="gram_schmidt-1092"><a href="#gram_schmidt-1092"><span class="linenos">1092</span></a>    <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="gram_schmidt-1093"><a href="#gram_schmidt-1093"><span class="linenos">1093</span></a>        <span class="c1"># Proiezione di k su e1 ed e2 e ortogonalizzazione</span>
</span><span id="gram_schmidt-1094"><a href="#gram_schmidt-1094"><span class="linenos">1094</span></a>        <span class="n">proj_k_on_e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">e1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e1</span>
</span><span id="gram_schmidt-1095"><a href="#gram_schmidt-1095"><span class="linenos">1095</span></a>        <span class="n">proj_k_on_e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">e2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="n">e2</span>
</span><span id="gram_schmidt-1096"><a href="#gram_schmidt-1096"><span class="linenos">1096</span></a>        <span class="n">u3</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">proj_k_on_e1</span> <span class="o">-</span> <span class="n">proj_k_on_e2</span>
</span><span id="gram_schmidt-1097"><a href="#gram_schmidt-1097"><span class="linenos">1097</span></a>        <span class="n">e3</span> <span class="o">=</span> <span class="n">u3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="gram_schmidt-1098"><a href="#gram_schmidt-1098"><span class="linenos">1098</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="gram_schmidt-1099"><a href="#gram_schmidt-1099"><span class="linenos">1099</span></a>
</span><span id="gram_schmidt-1100"><a href="#gram_schmidt-1100"><span class="linenos">1100</span></a>        <span class="c1"># calcolo come prodotto vettoriale</span>
</span><span id="gram_schmidt-1101"><a href="#gram_schmidt-1101"><span class="linenos">1101</span></a>        <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
</span><span id="gram_schmidt-1102"><a href="#gram_schmidt-1102"><span class="linenos">1102</span></a>
</span><span id="gram_schmidt-1103"><a href="#gram_schmidt-1103"><span class="linenos">1103</span></a>    <span class="c1"># Stack dei vettori ortonormali come colonne della matrice di rotazione</span>
</span><span id="gram_schmidt-1104"><a href="#gram_schmidt-1104"><span class="linenos">1104</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># shape (N, 3, 3)</span>
</span></pre></div>


            <div class="docstring"><p>applies Gram-Schmidt process to obtain ortonormal bases starting from
3 vectors (i, j, k)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>- i, j, k</strong> (array (N, 3)):</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>- R</strong> (array (N, 3, 3)):</li>
</ul>
</div>


                </section>
                <section id="fillna">
                            <input id="fillna-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fillna</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_regressors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="fillna-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fillna"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fillna-1107"><a href="#fillna-1107"><span class="linenos">1107</span></a><span class="k">def</span><span class="w"> </span><span class="nf">fillna</span><span class="p">(</span>
</span><span id="fillna-1108"><a href="#fillna-1108"><span class="linenos">1108</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span>
</span><span id="fillna-1109"><a href="#fillna-1109"><span class="linenos">1109</span></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="fillna-1110"><a href="#fillna-1110"><span class="linenos">1110</span></a>    <span class="n">n_regressors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="fillna-1111"><a href="#fillna-1111"><span class="linenos">1111</span></a>    <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="fillna-1112"><a href="#fillna-1112"><span class="linenos">1112</span></a><span class="p">):</span>
</span><span id="fillna-1113"><a href="#fillna-1113"><span class="linenos">1113</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="fillna-1114"><a href="#fillna-1114"><span class="linenos">1114</span></a><span class="sd">    Fill missing values in the array or dataframe.</span>
</span><span id="fillna-1115"><a href="#fillna-1115"><span class="linenos">1115</span></a>
</span><span id="fillna-1116"><a href="#fillna-1116"><span class="linenos">1116</span></a><span class="sd">    Parameters</span>
</span><span id="fillna-1117"><a href="#fillna-1117"><span class="linenos">1117</span></a><span class="sd">    ----------</span>
</span><span id="fillna-1118"><a href="#fillna-1118"><span class="linenos">1118</span></a><span class="sd">    arr : np.ndarray | DataFrame | Series,</span>
</span><span id="fillna-1119"><a href="#fillna-1119"><span class="linenos">1119</span></a><span class="sd">        array with nans to be filled</span>
</span><span id="fillna-1120"><a href="#fillna-1120"><span class="linenos">1120</span></a>
</span><span id="fillna-1121"><a href="#fillna-1121"><span class="linenos">1121</span></a><span class="sd">    value : float or None</span>
</span><span id="fillna-1122"><a href="#fillna-1122"><span class="linenos">1122</span></a><span class="sd">        the value to be used for missing data replacement.</span>
</span><span id="fillna-1123"><a href="#fillna-1123"><span class="linenos">1123</span></a><span class="sd">        if None, nearest neighbours imputation from the sklearn package is</span>
</span><span id="fillna-1124"><a href="#fillna-1124"><span class="linenos">1124</span></a><span class="sd">        used.</span>
</span><span id="fillna-1125"><a href="#fillna-1125"><span class="linenos">1125</span></a>
</span><span id="fillna-1126"><a href="#fillna-1126"><span class="linenos">1126</span></a><span class="sd">    n_regressors : int | None, default=None</span>
</span><span id="fillna-1127"><a href="#fillna-1127"><span class="linenos">1127</span></a><span class="sd">        Number of regressors to be used in a Multiple Linear Regression model.</span>
</span><span id="fillna-1128"><a href="#fillna-1128"><span class="linenos">1128</span></a><span class="sd">        The model used the &quot;n_regressors&quot; most correlated columns of</span>
</span><span id="fillna-1129"><a href="#fillna-1129"><span class="linenos">1129</span></a><span class="sd">        arr as independent variables to fit the missing values. The procedure</span>
</span><span id="fillna-1130"><a href="#fillna-1130"><span class="linenos">1130</span></a><span class="sd">        is repeated for each dimension separately.</span>
</span><span id="fillna-1131"><a href="#fillna-1131"><span class="linenos">1131</span></a><span class="sd">        If None, cubic spline interpolation is used on each column separately.</span>
</span><span id="fillna-1132"><a href="#fillna-1132"><span class="linenos">1132</span></a>
</span><span id="fillna-1133"><a href="#fillna-1133"><span class="linenos">1133</span></a><span class="sd">    inplace : bool, optional</span>
</span><span id="fillna-1134"><a href="#fillna-1134"><span class="linenos">1134</span></a><span class="sd">        If True, fill in place (for DataFrame/Series). If False, return a new object.</span>
</span><span id="fillna-1135"><a href="#fillna-1135"><span class="linenos">1135</span></a>
</span><span id="fillna-1136"><a href="#fillna-1136"><span class="linenos">1136</span></a><span class="sd">    Returns</span>
</span><span id="fillna-1137"><a href="#fillna-1137"><span class="linenos">1137</span></a><span class="sd">    -------</span>
</span><span id="fillna-1138"><a href="#fillna-1138"><span class="linenos">1138</span></a><span class="sd">    filled: np.ndarray, DataFrame, or Series</span>
</span><span id="fillna-1139"><a href="#fillna-1139"><span class="linenos">1139</span></a><span class="sd">        the vector without missing data.</span>
</span><span id="fillna-1140"><a href="#fillna-1140"><span class="linenos">1140</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="fillna-1141"><a href="#fillna-1141"><span class="linenos">1141</span></a>    <span class="c1"># check if missing values exist</span>
</span><span id="fillna-1142"><a href="#fillna-1142"><span class="linenos">1142</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Series</span><span class="p">)):</span>
</span><span id="fillna-1143"><a href="#fillna-1143"><span class="linenos">1143</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="fillna-1144"><a href="#fillna-1144"><span class="linenos">1144</span></a>            <span class="s2">&quot;&#39;arr&#39; must be a numpy.ndarray a pandas.DataFrame or a pandas.Series.&quot;</span>
</span><span id="fillna-1145"><a href="#fillna-1145"><span class="linenos">1145</span></a>        <span class="p">)</span>
</span><span id="fillna-1146"><a href="#fillna-1146"><span class="linenos">1146</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="fillna-1147"><a href="#fillna-1147"><span class="linenos">1147</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="fillna-1148"><a href="#fillna-1148"><span class="linenos">1148</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="fillna-1149"><a href="#fillna-1149"><span class="linenos">1149</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="fillna-1150"><a href="#fillna-1150"><span class="linenos">1150</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="fillna-1151"><a href="#fillna-1151"><span class="linenos">1151</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="n">arr</span> <span class="k">if</span> <span class="n">inplace</span> <span class="k">else</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="fillna-1152"><a href="#fillna-1152"><span class="linenos">1152</span></a>    <span class="n">miss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</span><span id="fillna-1153"><a href="#fillna-1153"><span class="linenos">1153</span></a>
</span><span id="fillna-1154"><a href="#fillna-1154"><span class="linenos">1154</span></a>    <span class="c1"># otherwise return a copy of the actual vector</span>
</span><span id="fillna-1155"><a href="#fillna-1155"><span class="linenos">1155</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">miss</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
</span><span id="fillna-1156"><a href="#fillna-1156"><span class="linenos">1156</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1157"><a href="#fillna-1157"><span class="linenos">1157</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1158"><a href="#fillna-1158"><span class="linenos">1158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="fillna-1159"><a href="#fillna-1159"><span class="linenos">1159</span></a>            <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="fillna-1160"><a href="#fillna-1160"><span class="linenos">1160</span></a>
</span><span id="fillna-1161"><a href="#fillna-1161"><span class="linenos">1161</span></a>    <span class="c1"># fill with the given value</span>
</span><span id="fillna-1162"><a href="#fillna-1162"><span class="linenos">1162</span></a>    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="fillna-1163"><a href="#fillna-1163"><span class="linenos">1163</span></a>        <span class="n">obj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">miss</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="fillna-1164"><a href="#fillna-1164"><span class="linenos">1164</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="fillna-1165"><a href="#fillna-1165"><span class="linenos">1165</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1166"><a href="#fillna-1166"><span class="linenos">1166</span></a>                <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1167"><a href="#fillna-1167"><span class="linenos">1167</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1168"><a href="#fillna-1168"><span class="linenos">1168</span></a>            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="fillna-1169"><a href="#fillna-1169"><span class="linenos">1169</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="fillna-1170"><a href="#fillna-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1171"><a href="#fillna-1171"><span class="linenos">1171</span></a>                <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1172"><a href="#fillna-1172"><span class="linenos">1172</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1173"><a href="#fillna-1173"><span class="linenos">1173</span></a>            <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="fillna-1174"><a href="#fillna-1174"><span class="linenos">1174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="fillna-1175"><a href="#fillna-1175"><span class="linenos">1175</span></a>            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1176"><a href="#fillna-1176"><span class="linenos">1176</span></a>                <span class="n">arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1177"><a href="#fillna-1177"><span class="linenos">1177</span></a>                <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1178"><a href="#fillna-1178"><span class="linenos">1178</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span><span id="fillna-1179"><a href="#fillna-1179"><span class="linenos">1179</span></a>
</span><span id="fillna-1180"><a href="#fillna-1180"><span class="linenos">1180</span></a>    <span class="c1"># check if linear regression models have to be used</span>
</span><span id="fillna-1181"><a href="#fillna-1181"><span class="linenos">1181</span></a>    <span class="k">if</span> <span class="n">n_regressors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="fillna-1182"><a href="#fillna-1182"><span class="linenos">1182</span></a>        <span class="c1"># get the correlation matrix</span>
</span><span id="fillna-1183"><a href="#fillna-1183"><span class="linenos">1183</span></a>        <span class="n">cmat</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1184"><a href="#fillna-1184"><span class="linenos">1184</span></a>
</span><span id="fillna-1185"><a href="#fillna-1185"><span class="linenos">1185</span></a>        <span class="c1"># predict the missing values via linear regression over each column</span>
</span><span id="fillna-1186"><a href="#fillna-1186"><span class="linenos">1186</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="fillna-1187"><a href="#fillna-1187"><span class="linenos">1187</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ycol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="fillna-1188"><a href="#fillna-1188"><span class="linenos">1188</span></a>
</span><span id="fillna-1189"><a href="#fillna-1189"><span class="linenos">1189</span></a>            <span class="c1"># get the best regressors</span>
</span><span id="fillna-1190"><a href="#fillna-1190"><span class="linenos">1190</span></a>            <span class="n">corrs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cmat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="fillna-1191"><a href="#fillna-1191"><span class="linenos">1191</span></a>            <span class="n">cor_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">corrs</span><span class="p">)[</span><span class="o">-</span><span class="n">n_regressors</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="fillna-1192"><a href="#fillna-1192"><span class="linenos">1192</span></a>            <span class="n">xcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cor_idx</span><span class="p">]</span>
</span><span id="fillna-1193"><a href="#fillna-1193"><span class="linenos">1193</span></a>
</span><span id="fillna-1194"><a href="#fillna-1194"><span class="linenos">1194</span></a>            <span class="c1"># get the indices of the samples that can be used for training</span>
</span><span id="fillna-1195"><a href="#fillna-1195"><span class="linenos">1195</span></a>            <span class="c1"># the regression model and those samples that can be predicted</span>
</span><span id="fillna-1196"><a href="#fillna-1196"><span class="linenos">1196</span></a>            <span class="c1"># with that model</span>
</span><span id="fillna-1197"><a href="#fillna-1197"><span class="linenos">1197</span></a>            <span class="n">i_old</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obj</span><span class="p">[[</span><span class="n">ycol</span><span class="p">]</span> <span class="o">+</span> <span class="n">xcols</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
</span><span id="fillna-1198"><a href="#fillna-1198"><span class="linenos">1198</span></a>            <span class="n">i_new</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="n">ycol</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">obj</span><span class="p">[</span><span class="n">xcols</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
</span><span id="fillna-1199"><a href="#fillna-1199"><span class="linenos">1199</span></a>
</span><span id="fillna-1200"><a href="#fillna-1200"><span class="linenos">1200</span></a>            <span class="c1"># if there are enough valid samples get the predictions and replace</span>
</span><span id="fillna-1201"><a href="#fillna-1201"><span class="linenos">1201</span></a>            <span class="c1"># the missing data</span>
</span><span id="fillna-1202"><a href="#fillna-1202"><span class="linenos">1202</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_new</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="fillna-1203"><a href="#fillna-1203"><span class="linenos">1203</span></a>                <span class="n">xmat</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_old</span><span class="p">,</span> <span class="n">xcols</span><span class="p">]</span>
</span><span id="fillna-1204"><a href="#fillna-1204"><span class="linenos">1204</span></a>                <span class="n">yarr</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_old</span><span class="p">,</span> <span class="p">[</span><span class="n">ycol</span><span class="p">]]</span>
</span><span id="fillna-1205"><a href="#fillna-1205"><span class="linenos">1205</span></a>                <span class="n">lrm</span> <span class="o">=</span> <span class="n">PolynomialRegression</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xmat</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>
</span><span id="fillna-1206"><a href="#fillna-1206"><span class="linenos">1206</span></a>                <span class="n">preds</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_new</span><span class="p">,</span> <span class="n">xcols</span><span class="p">])</span>
</span><span id="fillna-1207"><a href="#fillna-1207"><span class="linenos">1207</span></a>                <span class="n">obj</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i_new</span><span class="p">,</span> <span class="n">ycol</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="fillna-1208"><a href="#fillna-1208"><span class="linenos">1208</span></a>
</span><span id="fillna-1209"><a href="#fillna-1209"><span class="linenos">1209</span></a>    <span class="c1"># fill the missing data of each set via cubic spline</span>
</span><span id="fillna-1210"><a href="#fillna-1210"><span class="linenos">1210</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
</span><span id="fillna-1211"><a href="#fillna-1211"><span class="linenos">1211</span></a>        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="fillna-1212"><a href="#fillna-1212"><span class="linenos">1212</span></a>        <span class="n">x_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="fillna-1213"><a href="#fillna-1213"><span class="linenos">1213</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_old</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="fillna-1214"><a href="#fillna-1214"><span class="linenos">1214</span></a>            <span class="n">y_old</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">x_old</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="fillna-1215"><a href="#fillna-1215"><span class="linenos">1215</span></a>            <span class="n">obj</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">x_new</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x_old</span><span class="p">,</span> <span class="n">y_old</span><span class="p">)(</span><span class="n">x_new</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="fillna-1216"><a href="#fillna-1216"><span class="linenos">1216</span></a>
</span><span id="fillna-1217"><a href="#fillna-1217"><span class="linenos">1217</span></a>    <span class="c1"># return the filled array</span>
</span><span id="fillna-1218"><a href="#fillna-1218"><span class="linenos">1218</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="fillna-1219"><a href="#fillna-1219"><span class="linenos">1219</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1220"><a href="#fillna-1220"><span class="linenos">1220</span></a>            <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1221"><a href="#fillna-1221"><span class="linenos">1221</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1222"><a href="#fillna-1222"><span class="linenos">1222</span></a>        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="fillna-1223"><a href="#fillna-1223"><span class="linenos">1223</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
</span><span id="fillna-1224"><a href="#fillna-1224"><span class="linenos">1224</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1225"><a href="#fillna-1225"><span class="linenos">1225</span></a>            <span class="n">arr</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1226"><a href="#fillna-1226"><span class="linenos">1226</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1227"><a href="#fillna-1227"><span class="linenos">1227</span></a>        <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="fillna-1228"><a href="#fillna-1228"><span class="linenos">1228</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="fillna-1229"><a href="#fillna-1229"><span class="linenos">1229</span></a>        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
</span><span id="fillna-1230"><a href="#fillna-1230"><span class="linenos">1230</span></a>            <span class="n">arr</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span>
</span><span id="fillna-1231"><a href="#fillna-1231"><span class="linenos">1231</span></a>            <span class="k">return</span> <span class="n">arr</span>
</span><span id="fillna-1232"><a href="#fillna-1232"><span class="linenos">1232</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="fillna-1233"><a href="#fillna-1233"><span class="linenos">1233</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Fill missing values in the array or dataframe.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray | DataFrame | Series,):
array with nans to be filled</li>
<li><strong>value</strong> (float or None):
the value to be used for missing data replacement.
if None, nearest neighbours imputation from the sklearn package is
used.</li>
<li><strong>n_regressors</strong> (int | None, default=None):
Number of regressors to be used in a Multiple Linear Regression model.
The model used the "n_regressors" most correlated columns of
arr as independent variables to fit the missing values. The procedure
is repeated for each dimension separately.
If None, cubic spline interpolation is used on each column separately.</li>
<li><strong>inplace</strong> (bool, optional):
If True, fill in place (for DataFrame/Series). If False, return a new object.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>filled</strong> (np.ndarray, DataFrame, or Series):
the vector without missing data.</li>
</ul>
</div>


                </section>
                <section id="tkeo">
                            <input id="tkeo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tkeo</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="tkeo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tkeo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tkeo-1236"><a href="#tkeo-1236"><span class="linenos">1236</span></a><span class="k">def</span><span class="w"> </span><span class="nf">tkeo</span><span class="p">(</span>
</span><span id="tkeo-1237"><a href="#tkeo-1237"><span class="linenos">1237</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="tkeo-1238"><a href="#tkeo-1238"><span class="linenos">1238</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="tkeo-1239"><a href="#tkeo-1239"><span class="linenos">1239</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tkeo-1240"><a href="#tkeo-1240"><span class="linenos">1240</span></a><span class="sd">    Obtain the discrete Teager-Keiser Energy of the input signal.</span>
</span><span id="tkeo-1241"><a href="#tkeo-1241"><span class="linenos">1241</span></a>
</span><span id="tkeo-1242"><a href="#tkeo-1242"><span class="linenos">1242</span></a><span class="sd">    Parameters</span>
</span><span id="tkeo-1243"><a href="#tkeo-1243"><span class="linenos">1243</span></a><span class="sd">    ----------</span>
</span><span id="tkeo-1244"><a href="#tkeo-1244"><span class="linenos">1244</span></a><span class="sd">    arr : np.ndarray</span>
</span><span id="tkeo-1245"><a href="#tkeo-1245"><span class="linenos">1245</span></a><span class="sd">        A 1D input signal.</span>
</span><span id="tkeo-1246"><a href="#tkeo-1246"><span class="linenos">1246</span></a>
</span><span id="tkeo-1247"><a href="#tkeo-1247"><span class="linenos">1247</span></a><span class="sd">    Returns</span>
</span><span id="tkeo-1248"><a href="#tkeo-1248"><span class="linenos">1248</span></a><span class="sd">    -------</span>
</span><span id="tkeo-1249"><a href="#tkeo-1249"><span class="linenos">1249</span></a><span class="sd">    np.ndarray</span>
</span><span id="tkeo-1250"><a href="#tkeo-1250"><span class="linenos">1250</span></a><span class="sd">        The Teager-Keiser energy.</span>
</span><span id="tkeo-1251"><a href="#tkeo-1251"><span class="linenos">1251</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tkeo-1252"><a href="#tkeo-1252"><span class="linenos">1252</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">*</span> <span class="n">arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="tkeo-1253"><a href="#tkeo-1253"><span class="linenos">1253</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">out</span><span class="p">,</span> <span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Obtain the discrete Teager-Keiser Energy of the input signal.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>arr</strong> (np.ndarray):
A 1D input signal.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>np.ndarray</strong>: The Teager-Keiser energy.</li>
</ul>
</div>


                </section>
                <section id="to_reference_frame">
                            <input id="to_reference_frame-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_reference_frame</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">obj</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">origin</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis1</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis2</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis3</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="to_reference_frame-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#to_reference_frame"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="to_reference_frame-1256"><a href="#to_reference_frame-1256"><span class="linenos">1256</span></a><span class="k">def</span><span class="w"> </span><span class="nf">to_reference_frame</span><span class="p">(</span>
</span><span id="to_reference_frame-1257"><a href="#to_reference_frame-1257"><span class="linenos">1257</span></a>    <span class="n">obj</span><span class="p">:</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span><span id="to_reference_frame-1258"><a href="#to_reference_frame-1258"><span class="linenos">1258</span></a>    <span class="n">origin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="to_reference_frame-1259"><a href="#to_reference_frame-1259"><span class="linenos">1259</span></a>    <span class="n">axis1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="to_reference_frame-1260"><a href="#to_reference_frame-1260"><span class="linenos">1260</span></a>    <span class="n">axis2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="to_reference_frame-1261"><a href="#to_reference_frame-1261"><span class="linenos">1261</span></a>    <span class="n">axis3</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="to_reference_frame-1262"><a href="#to_reference_frame-1262"><span class="linenos">1262</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="to_reference_frame-1263"><a href="#to_reference_frame-1263"><span class="linenos">1263</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="to_reference_frame-1264"><a href="#to_reference_frame-1264"><span class="linenos">1264</span></a><span class="sd">    Rotate a 3D array or dataframe to the provided reference frame.</span>
</span><span id="to_reference_frame-1265"><a href="#to_reference_frame-1265"><span class="linenos">1265</span></a>
</span><span id="to_reference_frame-1266"><a href="#to_reference_frame-1266"><span class="linenos">1266</span></a><span class="sd">    Parameters</span>
</span><span id="to_reference_frame-1267"><a href="#to_reference_frame-1267"><span class="linenos">1267</span></a><span class="sd">    ----------</span>
</span><span id="to_reference_frame-1268"><a href="#to_reference_frame-1268"><span class="linenos">1268</span></a><span class="sd">    obj : DataFrame or np.ndarray</span>
</span><span id="to_reference_frame-1269"><a href="#to_reference_frame-1269"><span class="linenos">1269</span></a><span class="sd">        The 3D array or dataframe to be rotated.</span>
</span><span id="to_reference_frame-1270"><a href="#to_reference_frame-1270"><span class="linenos">1270</span></a><span class="sd">    origin : np.ndarray or list, optional</span>
</span><span id="to_reference_frame-1271"><a href="#to_reference_frame-1271"><span class="linenos">1271</span></a><span class="sd">        Coordinates of the target origin.</span>
</span><span id="to_reference_frame-1272"><a href="#to_reference_frame-1272"><span class="linenos">1272</span></a><span class="sd">    axis1 : np.ndarray or list, optional</span>
</span><span id="to_reference_frame-1273"><a href="#to_reference_frame-1273"><span class="linenos">1273</span></a><span class="sd">        Orientation of the first axis of the new reference frame.</span>
</span><span id="to_reference_frame-1274"><a href="#to_reference_frame-1274"><span class="linenos">1274</span></a><span class="sd">    axis2 : np.ndarray or list, optional</span>
</span><span id="to_reference_frame-1275"><a href="#to_reference_frame-1275"><span class="linenos">1275</span></a><span class="sd">        Orientation of the second axis of the new reference frame.</span>
</span><span id="to_reference_frame-1276"><a href="#to_reference_frame-1276"><span class="linenos">1276</span></a><span class="sd">    axis3 : np.ndarray or list, optional</span>
</span><span id="to_reference_frame-1277"><a href="#to_reference_frame-1277"><span class="linenos">1277</span></a><span class="sd">        Orientation of the third axis of the new reference frame.</span>
</span><span id="to_reference_frame-1278"><a href="#to_reference_frame-1278"><span class="linenos">1278</span></a>
</span><span id="to_reference_frame-1279"><a href="#to_reference_frame-1279"><span class="linenos">1279</span></a><span class="sd">    Returns</span>
</span><span id="to_reference_frame-1280"><a href="#to_reference_frame-1280"><span class="linenos">1280</span></a><span class="sd">    -------</span>
</span><span id="to_reference_frame-1281"><a href="#to_reference_frame-1281"><span class="linenos">1281</span></a><span class="sd">    DataFrame or np.ndarray</span>
</span><span id="to_reference_frame-1282"><a href="#to_reference_frame-1282"><span class="linenos">1282</span></a><span class="sd">        The rotated data.</span>
</span><span id="to_reference_frame-1283"><a href="#to_reference_frame-1283"><span class="linenos">1283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="to_reference_frame-1284"><a href="#to_reference_frame-1284"><span class="linenos">1284</span></a>
</span><span id="to_reference_frame-1285"><a href="#to_reference_frame-1285"><span class="linenos">1285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_array</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="to_reference_frame-1286"><a href="#to_reference_frame-1286"><span class="linenos">1286</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;origin, axis1, axis2 and axis3 have to be&quot;</span>
</span><span id="to_reference_frame-1287"><a href="#to_reference_frame-1287"><span class="linenos">1287</span></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; castable to 1D arrays of len = 3.&quot;</span>
</span><span id="to_reference_frame-1288"><a href="#to_reference_frame-1288"><span class="linenos">1288</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="to_reference_frame-1289"><a href="#to_reference_frame-1289"><span class="linenos">1289</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arr</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="to_reference_frame-1290"><a href="#to_reference_frame-1290"><span class="linenos">1290</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="to_reference_frame-1291"><a href="#to_reference_frame-1291"><span class="linenos">1291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="to_reference_frame-1292"><a href="#to_reference_frame-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="to_reference_frame-1293"><a href="#to_reference_frame-1293"><span class="linenos">1293</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="to_reference_frame-1294"><a href="#to_reference_frame-1294"><span class="linenos">1294</span></a>        <span class="k">return</span> <span class="n">out</span>
</span><span id="to_reference_frame-1295"><a href="#to_reference_frame-1295"><span class="linenos">1295</span></a>
</span><span id="to_reference_frame-1296"><a href="#to_reference_frame-1296"><span class="linenos">1296</span></a>    <span class="c1"># check inputs</span>
</span><span id="to_reference_frame-1297"><a href="#to_reference_frame-1297"><span class="linenos">1297</span></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;obj&#39; must be a numeric pandas DataFrame or a 2D numpy array&quot;</span>
</span><span id="to_reference_frame-1298"><a href="#to_reference_frame-1298"><span class="linenos">1298</span></a>    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; with 3 elements along the second dimension.&quot;</span>
</span><span id="to_reference_frame-1299"><a href="#to_reference_frame-1299"><span class="linenos">1299</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="to_reference_frame-1300"><a href="#to_reference_frame-1300"><span class="linenos">1300</span></a>        <span class="n">dfr</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="to_reference_frame-1301"><a href="#to_reference_frame-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="to_reference_frame-1302"><a href="#to_reference_frame-1302"><span class="linenos">1302</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="to_reference_frame-1303"><a href="#to_reference_frame-1303"><span class="linenos">1303</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="to_reference_frame-1304"><a href="#to_reference_frame-1304"><span class="linenos">1304</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="to_reference_frame-1305"><a href="#to_reference_frame-1305"><span class="linenos">1305</span></a>    <span class="n">ori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
</span><span id="to_reference_frame-1306"><a href="#to_reference_frame-1306"><span class="linenos">1306</span></a>    <span class="n">ax1</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis1</span><span class="p">)</span>
</span><span id="to_reference_frame-1307"><a href="#to_reference_frame-1307"><span class="linenos">1307</span></a>    <span class="n">ax2</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis2</span><span class="p">)</span>
</span><span id="to_reference_frame-1308"><a href="#to_reference_frame-1308"><span class="linenos">1308</span></a>    <span class="n">ax3</span> <span class="o">=</span> <span class="n">_validate_array</span><span class="p">(</span><span class="n">axis3</span><span class="p">)</span>
</span><span id="to_reference_frame-1309"><a href="#to_reference_frame-1309"><span class="linenos">1309</span></a>
</span><span id="to_reference_frame-1310"><a href="#to_reference_frame-1310"><span class="linenos">1310</span></a>    <span class="c1"># create the rotation matrix</span>
</span><span id="to_reference_frame-1311"><a href="#to_reference_frame-1311"><span class="linenos">1311</span></a>    <span class="n">rmat</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_matrix</span><span class="p">(</span><span class="n">gram_schmidt</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">))</span>
</span><span id="to_reference_frame-1312"><a href="#to_reference_frame-1312"><span class="linenos">1312</span></a>
</span><span id="to_reference_frame-1313"><a href="#to_reference_frame-1313"><span class="linenos">1313</span></a>    <span class="c1"># apply</span>
</span><span id="to_reference_frame-1314"><a href="#to_reference_frame-1314"><span class="linenos">1314</span></a>    <span class="n">rotated</span> <span class="o">=</span> <span class="n">rmat</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">ori</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</span><span id="to_reference_frame-1315"><a href="#to_reference_frame-1315"><span class="linenos">1315</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
</span><span id="to_reference_frame-1316"><a href="#to_reference_frame-1316"><span class="linenos">1316</span></a>        <span class="k">return</span> <span class="n">rotated</span>
</span><span id="to_reference_frame-1317"><a href="#to_reference_frame-1317"><span class="linenos">1317</span></a>    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">rotated</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rotate a 3D array or dataframe to the provided reference frame.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obj</strong> (DataFrame or np.ndarray):
The 3D array or dataframe to be rotated.</li>
<li><strong>origin</strong> (np.ndarray or list, optional):
Coordinates of the target origin.</li>
<li><strong>axis1</strong> (np.ndarray or list, optional):
Orientation of the first axis of the new reference frame.</li>
<li><strong>axis2</strong> (np.ndarray or list, optional):
Orientation of the second axis of the new reference frame.</li>
<li><strong>axis3</strong> (np.ndarray or list, optional):
Orientation of the third axis of the new reference frame.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>DataFrame or np.ndarray</strong>: The rotated data.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>